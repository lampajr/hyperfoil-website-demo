<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://lampajr.github.io/hyperfoil-website-demo/blog/><link rel=alternate type=application/rss+xml href=https://lampajr.github.io/hyperfoil-website-demo/blog/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/hyperfoil-website-demo/favicons/favicon.ico><link rel=apple-touch-icon href=/hyperfoil-website-demo/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/hyperfoil-website-demo/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/hyperfoil-website-demo/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/hyperfoil-website-demo/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/hyperfoil-website-demo/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/hyperfoil-website-demo/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/hyperfoil-website-demo/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/hyperfoil-website-demo/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/hyperfoil-website-demo/favicons/android-192x192.png sizes=192x192><title>Blog | Hyperfoil</title><meta name=description content="Microservice-oriented distributed benchmark framework."><meta property="og:title" content="Blog"><meta property="og:description" content="Microservice-oriented distributed benchmark framework."><meta property="og:type" content="website"><meta property="og:url" content="https://lampajr.github.io/hyperfoil-website-demo/blog/"><meta itemprop=name content="Blog"><meta itemprop=description content="Microservice-oriented distributed benchmark framework."><meta name=twitter:card content="summary"><meta name=twitter:title content="Blog"><meta name=twitter:description content="Microservice-oriented distributed benchmark framework."><link rel=preload href=/hyperfoil-website-demo/scss/main.min.c4a9e1fde5dcceec6bbb57977a65d8acb2f196f8a06900b4aab3ef4cbe000bc5.css as=style><link href=/hyperfoil-website-demo/scss/main.min.c4a9e1fde5dcceec6bbb57977a65d8acb2f196f8a06900b4aab3ef4cbe000bc5.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/hyperfoil-website-demo/><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300" height="65" viewBox="0 0 301 65"><g id="surface1"><path style="stroke:none;fill-rule:nonzero;fill:#3075b1;fill-opacity:1" d="M52.84375 13.402344c3.972656.0 7.945312.0 12.039062.0C64.675781 14.992188 64.46875 16.582031 64.253906 18.21875 64.191406 18.710938 64.128906 19.207031 64.0625 19.714844 63.746094 22.109375 63.347656 24.433594 62.875 26.804688c2.429688.0 4.855469.0 7.359375.0C70.320312 26.117188 70.410156 25.429688 70.503906 24.722656 70.621094 23.8125 70.742188 22.898438 70.859375 21.988281 70.917969 21.535156 70.976562 21.085938 71.035156 20.621094 71.355469 18.191406 71.746094 15.800781 72.238281 13.402344 75.65625 13.386719 79.074219 13.375 82.492188 13.367188 83.65625 13.363281 84.816406 13.355469 85.980469 13.351562 87.648438 13.34375 89.320312 13.339844 90.988281 13.335938 91.511719 13.332031 92.035156 13.328125 92.574219 13.324219c1.246093.0 2.496093.0351560000000006 3.746093.078125C97.6875 14.769531 97.265625 17.582031 97.363281 19.476562 97.511719 22.109375 97.511719 22.109375 97.65625 24.792969c1.546875-3.757813 3.089844-7.519531 4.683594-11.390625C106.910156 13.351562 111.480469 13.316406 116.050781 13.292969 117.601562 13.28125 119.15625 13.269531 120.707031 13.25 122.945312 13.226562 125.183594 13.214844 127.421875 13.207031 128.113281 13.195312 128.800781 13.183594 129.511719 13.175781 133.644531 13.171875 136.710938 13.640625 140.464844 15.414062c2.371094 2.371094 2.628906 4.730469 2.886718 7.996094C143.265625 29.070312 141.609375 35.269531 137.523438 39.335938c-4.679688 3.808593-10.078126 3.078124-15.785157 2.878906C121.296875 45.089844 120.855469 47.964844 120.398438 50.929688c-3.972657.0-7.945313.0-12.039063.0C108.847656 44.71875 109.964844 38.660156 111.078125 32.542969c.28125-1.558594.5625-3.121094.84375-4.679688C112.097656 26.898438 112.269531 25.9375 112.449219 24.972656c.335937000000001-1.878906.59375-3.625.59375-5.539062-1.5 2.71875-3 5.4375-4.5 8.15625-.507812999999999.921875-1.019531 1.847656-1.53125 2.769531-.734375 1.332031-1.464844 2.664063-2.199219 3.992187C104.585938 34.765625 104.355469 35.175781 104.125 35.597656c-1.910156 3.46875-3.257812 6.117188-3.832031 10.054688-.5625 3.804687-.5625 3.804687-1.296875 5.277344-3.972656.0-7.945313.0-12.039063.0C87.257812 49.460938 87.5625 47.996094 87.875 46.488281c1.414062-8.957031-1.5625-18.375-3.59375-27.054687-1.113281 3.640625-1.855469 7.261718-2.492188 11.011718C81.632812 31.328125 81.632812 31.328125 81.476562 32.226562 81.15625 34.089844 80.835938 35.953125 80.515625 37.820312c-.21875 1.269532-.4375 2.539063-.65625 3.808594C79.324219 44.726562 78.792969 47.828125 78.261719 50.929688c-3.976563.0-7.949219.0-12.042969.0C66.550781 46.511719 67.023438 42.453125 68.226562 38.195312c-2.648437.0-5.296874.0-8.027343.0C60.117188 39.425781 60.035156 40.65625 59.949219 41.921875 59.726562 45.238281 59.136719 47.617188 58.191406 50.929688c-3.75.0-7.503906.0-11.371094.0C47.246094 43.042969 48.761719 35.390625 50.207031 27.640625 50.464844 26.257812 50.71875 24.875 50.972656 23.492188 51.59375 20.125 52.214844 16.765625 52.84375 13.402344zm72.238281 10.050781C124.214844 26.355469 123.515625 29.160156 123.074219 32.164062c3.074219.25 3.074219.25 5.9375-.667968000000002 1.203125-2.140625 1.222656-4.265625 1.421875-6.703125-2.160156-1.441407-2.867188-1.472657-5.351563-1.339844zm0 0"/><path style="stroke:none;fill-rule:nonzero;fill:#fafcfd;fill-opacity:1" d="M12.792969-.0429688C13.648438-.0351562 14.507812-.03125 15.390625-.0234375 16.050781-.015625 16.710938-.0078125 17.390625.0 33.847656 36.132812 33.847656 36.132812 35.449219 44.898438 28.246094 48.9375 21.757812 50.421875 13.546875 50.46875 12.953125 50.472656 12.359375 50.472656 11.746094 50.476562 8.066406 50.4375 4.871094 49.949219 1.335938 48.917969-2.148438 33.503906-1.167969 14.703125 6.6875.671875 8.699219-.335938 10.5625-.0625 12.792969-.0429688zm0 0"/><path style="stroke:none;fill-rule:nonzero;fill:#3075b1;fill-opacity:1" d="M174.578125 13.402344C177.433594 13.351562 180.289062 13.316406 183.144531 13.292969 184.113281 13.28125 185.082031 13.269531 186.050781 13.25 196.136719 13.074219 196.136719 13.074219 200.667969 15.414062c2.375 2.378907 2.617187 4.515626 2.839843 7.789063C203.433594 28.203125 201.835938 33 198.660156 36.855469 197.234375 37.628906 197.234375 37.628906 195.984375 38.195312 196.347656 39.320312 196.347656 39.320312 196.714844 40.46875 197.03125 41.457031 197.34375 42.445312 197.65625 43.429688 197.816406 43.925781 197.976562 44.421875 198.140625 44.929688c.652343999999999 2.066406 1.1875 3.816406 1.1875 6-4.191406.0-8.386719.0-12.707031.0-2.257813-6.785157-2.257813-6.785157-2.675782-10.722657-.664062000000001.0-1.324218.0-2.007812.0C181.90625 40.644531 181.871094 41.082031 181.839844 41.53125 181.789062 42.117188 181.738281 42.703125 181.6875 43.304688c-.046875.574218000000002-.09375 1.152343-.140625 1.742187C181.269531 46.90625 181.269531 46.90625 179.929688 50.929688c-3.75.0-7.503907.0-11.371094.0.398437000000001-4.964844 1.011718-9.796876 1.90625-14.6875C170.582031 35.582031 170.699219 34.921875 170.820312 34.242188c.375-2.074219.75-4.148438 1.125-6.222657C172.203125 26.597656 172.457031 25.179688 172.710938 23.761719c.621093000000002-3.453125 1.242187-6.90625 1.867187-10.359375zm10.035156 10.050781C184.394531 25.664062 184.171875 27.875 183.945312 30.15625c2.285157.109375 2.285157.109375 4.679688.0 1.71875-1.722656 1.699219-3 2.007812-5.363281-2.296874-1.535157-3.335937-1.457031-6.019531-1.339844zm0 0"/><path style="stroke:none;fill-rule:nonzero;fill:#3075b1;fill-opacity:1" d="M248.15625 12.523438C248.609375 12.511719 249.058594 12.5 249.523438 12.488281 253.546875 12.484375 256.59375 13.445312 259.738281 16 263.234375 20.410156 262.6875 26.160156 262.203125 31.496094c-1.023437 6.945312-3.320313 12.792968-8.359375 17.714844-3.992188 2.5-7.804688 2.613281-12.375 2.597656C240.882812 51.816406 240.296875 51.828125 239.691406 51.839844 236.210938 51.84375 233.773438 51.542969 230.765625 49.585938c-3.589844-3.886719-3.625-7.460938-3.53125-12.554688.320312999999999-7 2.136719-15.65625 7.296875-20.667969 4.054688-3.160156 8.570312-3.863281 13.625-3.839843zm-5.832031 11.925781c-1.207031 2.375-1.574219 4.722656-1.984375 7.339843C240.210938 32.542969 240.210938 32.542969 240.078125 33.3125 239.644531 35.921875 239.460938 38.195312 239.460938 40.875c2.429687.0 4.855468.0 7.359374.0 2.023438-5.625 3.671876-11.382812 3.34375-17.421875C249.09375 23.382812 248.019531 23.328125 246.945312 23.285156 246.050781 23.238281 246.050781 23.238281 245.132812 23.191406 243.4375 23.308594 243.4375 23.308594 242.324219 24.449219zm0 0"/><path style="stroke:none;fill-rule:nonzero;fill:#3075b1;fill-opacity:1" d="M145.816406 13.402344c8.390625.0 16.777344.0 25.417969.0-1.335937 6.03125-1.335937 6.03125-2.675781 10.050781-4.191406.0-8.386719.0-12.707032.0.0 1.328125.0 2.652344.0 4.019531C159.382812 27.695312 162.914062 27.917969 166.554688 28.144531 166.113281 31.019531 165.671875 33.894531 165.214844 36.855469c-3.75.0-7.503906.0-11.371094.0C153.625 38.183594 153.402344 39.507812 153.175781 40.875c4.414063.0 8.828125.0 13.378907.0C165.96875 47.914062 165.96875 47.914062 165.214844 50.929688c-8.386719.0-16.773438.0-25.417969.0.453125-4.992188 1.007813-9.78125 1.90625-14.6875C141.820312 35.582031 141.9375 34.921875 142.058594 34.242188c.371093999999999-2.074219.75-4.148438 1.125-6.222657C143.4375 26.597656 143.695312 25.179688 143.949219 23.761719c.617187000000001-3.453125 1.242187-6.90625 1.867187-10.359375zm0 0"/><path style="stroke:none;fill-rule:nonzero;fill:#3075b1;fill-opacity:1" d="M207.355469 13.402344c7.945312.0 15.894531.0 24.082031.0-2.007812 7.371094-2.007812 7.371094-3.347656 10.050781C226.308594 23.765625 224.78125 23.917969 222.992188 23.957031 222.519531 23.976562 222.046875 23.996094 221.558594 24.015625c-1.167969.046875-2.332032.078125-3.5.109375C217.835938 25.449219 217.617188 26.777344 217.390625 28.144531c3.089844.0 6.179687.0 9.363281.0-1.253906 7.875-1.253906 7.875-2.007812 9.382813-3.089844.0-6.179688.0-9.363282.0C215.175781 38.992188 214.96875 40.457031 214.753906 41.964844 214.332031 44.960938 213.871094 47.941406 213.375 50.929688c-3.972656.0-7.945312.0-12.039062.0.394531000000001-4.964844 1.011718-9.796876 1.90625-14.6875C203.359375 35.582031 203.476562 34.921875 203.597656 34.242188 203.96875 32.167969 204.34375 30.09375 204.722656 28.019531 204.976562 26.597656 205.230469 25.179688 205.484375 23.761719c.621093999999999-3.453125 1.246094-6.90625 1.871094-10.359375zm0 0"/><path style="stroke:none;fill-rule:nonzero;fill:#3075b1;fill-opacity:1" d="M282.941406 13.402344c3.97265600000003.0 7.94531300000006.0 12.0390630000001.0C294.421875 16.777344 293.863281 20.152344 293.300781 23.523438 293.113281 24.671875 292.921875 25.820312 292.730469 26.964844 292.457031 28.617188 292.183594 30.269531 291.910156 31.921875 291.824219 32.433594 291.742188 32.941406 291.65625 33.46875 291.242188 35.949219 290.789062 38.410156 290.296875 40.875c3.53125.0 7.0625.0 10.703125.0C300.679688 44.300781 300.335938 47.550781 299.664062 50.929688c-7.726562.0-15.453124.0-23.414062.0C276.785156 47.605469 277.320312 44.28125 277.855469 40.960938 278.035156 39.835938 278.21875 38.710938 278.398438 37.585938 279.355469 31.621094 280.328125 25.65625 281.359375 19.703125 281.480469 18.980469 281.480469 18.980469 281.605469 18.242188 282.191406 14.898438 282.191406 14.898438 282.941406 13.402344zm0 0"/><path style="stroke:none;fill-rule:nonzero;fill:#3075b1;fill-opacity:1" d="M266.886719 13.402344c3.97265599999997.0 7.94531199999994.0 12.0390619999999.0C278.046875 21.011719 276.890625 28.523438 275.523438 36.0625 275.199219 37.851562 274.882812 39.640625 274.566406 41.433594 274.359375 42.574219 274.15625 43.710938 273.949219 44.851562 273.808594 45.652344 273.808594 45.652344 273.660156 46.472656 272.984375 50.179688 272.984375 50.179688 272.238281 50.929688 270.324219 50.976562 268.425781 50.988281 266.511719 50.96875 265.972656 50.964844 265.433594 50.964844 264.875 50.960938 263.539062 50.953125 262.203125 50.941406 260.867188 50.929688 261.242188 45.972656 261.878906 41.128906 262.769531 36.242188 262.890625 35.582031 263.007812 34.921875 263.128906 34.242188 263.5 32.167969 263.875 30.09375 264.253906 28.019531 264.507812 26.597656 264.761719 25.179688 265.015625 23.761719 265.636719 20.308594 266.261719 16.855469 266.886719 13.402344zm0 0"/><path style="stroke:none;fill-rule:nonzero;fill:#387ab4;fill-opacity:1" d="M12.792969-.0429688C13.648438-.0351562 14.507812-.03125 15.390625-.0234375 16.050781-.015625 16.710938-.0078125 17.390625.0 33.847656 36.132812 33.847656 36.132812 35.449219 44.898438 28.246094 48.9375 21.757812 50.421875 13.546875 50.46875 12.953125 50.472656 12.359375 50.472656 11.746094 50.476562 8.066406 50.4375 4.871094 49.949219 1.335938 48.917969-2.148438 33.503906-1.167969 14.703125 6.6875.671875 8.699219-.335938 10.5625-.0625 12.792969-.0429688zM9.363281 2.011719c-2.316406 4.3125-3.996093 8.695312-5.351562 13.402343C3.890625 15.828125 3.769531 16.242188 3.640625 16.667969c-1.25 4.785156-1.136719 9.535156-1.089844 14.449219.0.84375.0 1.6875.0 2.558593-.578125 7.691407-.578125 7.691407 1.460938 14.570313C8.652344 49.21875 13.339844 48.960938 18.058594 48.917969c0-3.316407.0-6.632813.0-10.050781.882812000000001.0 1.765625.0 2.675781.0C20.726562 39.320312 20.71875 39.769531 20.710938 40.238281 20.707031 40.835938 20.699219 41.433594 20.695312 42.050781 20.6875 42.640625 20.679688 43.230469 20.671875 43.839844 20.730469 45.421875 20.957031 46.738281 21.40625 48.246094 26.105469 47.945312 29.824219 46.828125 34.113281 44.898438 33.179688 39.777344 31.417969 35.292969 29.347656 30.53125 29.023438 29.773438 28.695312 29.011719 28.359375 28.226562c-2.710937-6.304687-5.476563-12.585937-8.292969-18.84375-.21875.0-.441406000000001.0-.667968000000002.0C19.300781 19.117188 19.300781 19.117188 20.066406 28.8125c-.882812000000001.0-1.765625.0-2.675781.0C17.375 28.214844 17.359375 27.617188 17.339844 27.003906 17.277344 24.757812 17.210938 22.515625 17.140625 20.269531 17.113281 19.304688 17.085938 18.335938 17.058594 17.371094 16.914062 12.222656 16.730469 7.121094 16.054688 2.011719c-2.207032.0-4.417969.0-6.691407.0zm0 0"/><path style="stroke:none;fill-rule:nonzero;fill:#3075b1;fill-opacity:1" d="M38.125 46.238281C37.492188 49.210938 36.457031 51.597656 34.113281 53.609375 31.898438 54.179688 29.820312 54.054688 27.550781 53.902344 26.957031 53.878906 26.367188 53.859375 25.757812 53.835938 24.304688 53.78125 22.855469 53.699219 21.40625 53.609375 21.625 54.492188 21.847656 55.378906 22.074219 56.289062 22.515625 56.066406 22.957031 55.847656 23.410156 55.617188c2.007813-.125 2.007813-.125 4.015625.0C27.867188 56.0625 28.308594 56.503906 28.761719 56.957031c-2.121094 1.265625-4.257813 2.5-6.394531 3.730469C21.765625 61.042969 21.167969 61.402344 20.550781 61.769531c-5.046875 2.871094-5.046875 2.871094-7.902343 2.535157C11.683594 63.984375 11.683594 63.984375 10.703125 63.660156 10.480469 63.21875 10.261719 62.773438 10.035156 62.320312c2.648438-1.328124 5.296875-2.65625 8.023438-4.019531.0-1.550781.0-3.097656.0-4.691406C17.140625 53.570312 17.140625 53.570312 16.199219 53.53125 11.511719 53.28125 7.621094 52.898438 3.34375 50.929688 5.925781 50.023438 8.222656 50.40625 10.910156 50.675781 18.121094 51.265625 24.734375 49.78125 31.527344 47.328125 33.683594 46.601562 35.855469 46.238281 38.125 46.238281zm0 0"/></g></svg></span><span class=navbar-brand__name>Hyperfoil</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/hyperfoil-website-demo/docs/><span>Docs</span></a></li><li class=nav-item><a class="nav-link active" href=/hyperfoil-website-demo/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/hyperfoil-website-demo/download/><span>Download</span></a></li><li class=nav-item><a class=nav-link href=/hyperfoil-website-demo/community/><span>Community</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/hyperfoil-website-demo/offline-search-index.0e38b7480d78b6a828ea18716ca2fc5f.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/hyperfoil-website-demo/blog/>Return to the regular view of this page</a>.</p></div><h1 class=title>Blog</h1><ul><li><a href=#pg-995c359e0eda056a2e3b98e604c59580>News</a></li><ul><li><a href=#pg-5cc26a1da57d395a60d8472b440fe640>Beginner's Guide to Hyperfoil: part 1</a></li><li><a href=#pg-8c654f0ee650a6a2e901c6d63171c237>Beginner's Guide to Hyperfoil: part 2</a></li><li><a href=#pg-cb9528e41fcdc1ef2ebe9f7790cd9590>Beginner's Guide to Hyperfoil: part 3</a></li><li><a href=#pg-39804ef6b6d4482ec1284210c43dc6a0>Compensation for coordinated omission</a></li><li><a href=#pg-73b10aadce864c10f1d9f5a7f61eddee>Fetch embedded resources</a></li><li><a href=#pg-bf45a523571dd9adee5767986c0dc3e8>Automatic follow of redirects</a></li></ul><li>2: <a href=#pg-fbc771f2981eed29c0bc016b2d68a41a>Releases</a></li><ul><li>2.1: <a href=#pg-7f5e49d79dd8d5f370882d2664b6586e>Release Notes</a></li></ul></ul><div class=content><p>This is the <strong>blog</strong> section. It has two categories: News and Releases.</p></div></div><div class=td-content><h1 id=pg-995c359e0eda056a2e3b98e604c59580>News</h1><div class=lead>Check out blog posts and articles on Hyperfoil</div><div class="td-byline mb-4"></div></div><div class=td-content><h1 id=pg-5cc26a1da57d395a60d8472b440fe640>Beginner's Guide to Hyperfoil: part 1</h1><div class=lead>Meet Hyperfoil, a swiss-army knife of web benchmark driver. You&rsquo;ll learn how to write a simple benchmark and run it straight from the CLI.</div><div class="td-byline mb-4"><time datetime=2021-01-25 class=text-body-secondary>Monday, January 25, 2021</time></div><h2 id=tldr>TLDR<a class=td-heading-self-link href=#tldr aria-label="Heading self-link"></a></h2><p>You&rsquo;ll learn how to write a simple Hyperfoil benchmark and run it straight from the CLI.</p><blockquote><p>This article is intended to be published on other sites, too - therefore it contains introduction to concepts this blog&rsquo;s readers are probably familiar with.</p></blockquote><h2 id=introduction>Introduction<a class=td-heading-self-link href=#introduction aria-label="Heading self-link"></a></h2><p>Meet Hyperfoil, a swiss-army knife of web benchmark driver. This is an opensource (<a href=https://github.com/Hyperfoil/Hyperfoil/blob/master/LICENSE>ASL2.0</a>) tool that sports a set of properties that we could not find in any of the existing load drivers:</p><ul><li>Do it the <strong>right way</strong>: Many tools use a <em>closed model</em> for driving the load - they spawn a fixed set of threads and fire synchronous requests, delaying further requests until the responses to previous ones arrive. While this is quite useful for quick tests, when you are only interested in the maximum throughput (and Hyperfoil supports this mode, too), applying feedback from the server does not simulate what latencies would users actually observe - closed model is subject to a <a href="https://www.youtube.com/watch?v=lJ8ydIuPFeU">coordinated omission problem</a>. Hyperfoil is designed with <em>open model</em> in mind, requests are executed asynchronously and independently of the responses from the tested system.</li><li>Drive the load <strong>as far as you need</strong>: Production systems often span whole clusters and you often can&rsquo;t drive up system utilization using a single load generator. With Hyperfoil you don&rsquo;t need to hack bash scripts to start the benchmark concurrently on several machines and then combine the results in a spreadsheet - Hyperfoil is distributed by design.</li><li>Don&rsquo;t oversimplify: In order to anticipate the behaviour when your users come the benchmark should do what do users would do. Hyperfoil is not limited to hitting a fixed set of URLs; you can describe complex logic in a YAML syntax, and if this is insufficient or too cumbersome you can extend it in good ol&rsquo; Java.</li><li>Opensource: There are lies, damned lies, and benchmarks. When we publish results we want everyone to be able to reproduce them, or prove us wrong. Having the tool publicly available is certainly a step towards that goal.</li></ul><h2 id=demo-workload>Demo workload<a class=td-heading-self-link href=#demo-workload aria-label="Heading self-link"></a></h2><p>In this series of blogposts we&rsquo;ll use <a href=https://github.com/Hyperfoil/vehicle-market>Vehicle Market</a>, a demo application using several microservices to run a used-car bazaar. You&rsquo;ll need either <a href=https://docs.docker.com/engine/install/>docker</a> and <a href=https://docs.docker.com/compose/install/>docker-compose</a> or <a href=https://podman.io/getting-started/installation>podman</a> and <a href=https://github.com/containers/podman-compose#installation>podman-compose</a> installed to get it running.</p><p>So let&rsquo;s start by spinning up the Vehicle Market:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -L http://vehicle-market.hyperfoil.io &gt; /tmp/vehicle-market.yaml
</span></span><span style=display:flex><span>podman-compose -f /tmp/vehicle-market.yaml -p vehicle-market up -d
</span></span></code></pre></div><p>Now you can go to <a href=http://localhost:8080>http://localhost:8080</a> and browse through the application.</p><h2 id=first-benchmark>First benchmark<a class=td-heading-self-link href=#first-benchmark aria-label="Heading self-link"></a></h2><p>In this first post we&rsquo;ll create a simple benchmark that does not realistically simulate a user, hitting different pages independently. Let&rsquo;s create a new directory, e.g. <code>$HOME/vehicle-market/benchmarks</code> to host our benchmarks there.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># VMB stands for Vehicle Market Benchmarks</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>VMB</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$HOME</span>/vehicle-market/benchmarks
</span></span><span style=display:flex><span>mkdir -p <span style=color:#000>$VMB</span>
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> <span style=color:#000>$VMB</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Temporary directory for the reports</span>
</span></span><span style=display:flex><span>mkdir /tmp/reports
</span></span></code></pre></div><p>Open a new file in your favourite editor (Visual Studio Code <a href=/docs/editor.html>would be a good choice</a>) and create your first benchmark, saving it as <code>first-benchmark.hf.yaml</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>first-benchmark</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>fetchIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>This benchmark is going create 10 connections (<code>sharedConnections</code> property) to <code>http://localhost:8080</code> and during 10 seconds (<code>duration</code> property) run the scenario 10 times per second in average (<code>usersPerSec</code> property). By default the in-VM agent (load generator) is single-threaded; the property is called <em>shared connections</em> because if you increase the thread count or run the benchmark in a distributed setup using multiple agents there will be still 10 connections to the tested system, evenly distributed among agents and threads.</p><p><strong>Hyperfoil does not operate with the notion of requests per second but with (virtual) users per second.</strong> Our scenario is the most trivial one, only firing single GET request to the root path (<code>/</code>) and therefore the number of requests equals to number of virtual users (also called user sessions).</p><p>We haven&rsquo;t commented yet on <code>fetchIndex</code>. The scenario consists of one or more reusable <em>sequences</em>, each comprised of one or more <em>steps</em>. In our example <code>fetchIndex</code> is the name of the sequence, and there&rsquo;s a single step: <a href=/docs/steps/step_httpRequest.html>httpRequest</a> (this can have many properties, <code>GET</code> selecting both the method and path being one of them).</p><h2 id=get-it-running>Get it running<a class=td-heading-self-link href=#get-it-running aria-label="Heading self-link"></a></h2><p>Now we have our benchmark defined we need to get Hyperfoil running. In future posts we&rsquo;ll show how to run Hyperfoil truly distributed on Openshift (it&rsquo;s possible to run it distributed on bare metal, too) but for now we&rsquo;ll just open the CLI in a container and start it all in-process:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>podman run -it --rm -v <span style=color:#000>$VMB</span>:/benchmarks:Z -v /tmp/reports:/tmp/reports:Z --network<span style=color:#ce5c00;font-weight:700>=</span>host quay.io/hyperfoil/hyperfoil cli
</span></span></code></pre></div><p>In the command above we are mounting the benchmarks directory into <code>/benchmarks</code> in the container and writable <code>/tmp/reports</code> to the same path for a report later on. We are also using <em>host network</em> - by default the container would have its own network and <code>localhost:8080</code> could not reach Vehicle Market.</p><p>In the CLI type <code>start-local</code> (tab completion works) to start Hyperfoil controller in the same VM, and then we can upload the benchmark (using <code>upload</code>) and start it with <code>run</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>hyperfoil]$ start-local</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>Starting controller in default directory (/tmp/hyperfoil)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>Controller started, listening on 127.0.0.1:45295</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>Connecting to the controller...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>Connected!</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>[</span><span style=color:#000>hyperfoil@in-vm]$ upload /benchmarks/first-benchmark.hf.yaml</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>Loaded benchmark first-benchmark, uploading...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>done.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>[</span><span style=color:#000>hyperfoil@in-vm]$ run first-benchmark</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>Started run 0000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>Run 0000, benchmark first-benchmark</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>Agents</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>in-vm[STOPPED]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>Started: 2021/01/25 17:00:31.869    Terminated</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#000>/01/25 17:00:41.881$</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>NAME  STATUS      STARTED       REMAINING  COMPLETED     TOTAL DURATION                DESCRIPTION</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>main  TERMINATED  17:00:31.869             17:00:41.880  10011 ms (exceeded by 11 ms)  10.00 users per second</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The benchmark successfully finished, it&rsquo;s time to check on the results. CLI lets you display a simplified table of results using command <code>stats</code>; you can get all the gory details in a JSON-formatted file using <code>export</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>hyperfoil@in-vm]$ stats</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>Total stats from run 0000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>PHASE  METRIC       THROUGHPUT   REQUESTS  MEAN     p50      p90      p99      p99.9     p99.99    2xx  3xx  4xx  5xx  CACHE  TIMEOUTS  ERRORS  BLOCKED</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>main   fetchIndex  10.60 req/s       106  5.23 ms  5.08 ms  6.91 ms  9.96 ms  10.62 ms  10.62 ms  106    0    0    0      0         0       0     0 ns</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>You might be concerned at first by seeing 106 requests instead of 100 here; that&rsquo;s by design, though. Hyperfoil does not execute the requests precisely every 100 ms because that&rsquo;s not what the users would do; the incoming users are randomized using <a href=https://en.wikipedia.org/wiki/Poisson_point_process>Poisson point process</a>.</p><p>Exploring the JSON from <code>export</code> might not be the most convenient way, but there&rsquo;s a third option: <code>report</code> command creates a fancy HTML report. Were you not running in a container a browser window with this report would be opened, too.</p><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>[hyperfoil@in-vm]$ report --destination=/tmp/reports
Written to /tmp/reports/0000.html
</code></pre><p>The front page shows only one rather wide column as we&rsquo;ve used only one phase, but when you switch to details in the top navbar you can see the progression of requests:</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:641px><img class=card-img-top src=/hyperfoil-website-demo/blog/news/2021-01-25-hf-beginner-guide-1/hf-beginner-guide-1-report-details_hu36224a20bb647bee18ebb0a0847642f3_36131_1800x400_fit_catmullrom_3.png width=631 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Report details example</p></p></figcaption></figure><h2 id=set-phasers-to-kill>Set phasers to kill<a class=td-heading-self-link href=#set-phasers-to-kill aria-label="Heading self-link"></a></h2><p>Allright, you could easily run a similar benchmark using other tools. Let&rsquo;s add a different type of request into the mix. For that, we will need to introduce you to the concept of <em>phases</em>. In Hyperfoil, phases are (by default) independent workloads. We&rsquo;ve already seen a <code>main</code> phase being reported in the statistics listing; the previous benchmark used a simplified single-constant-rate-phase syntax. When adding second phase we need to use the &lsquo;full&rsquo; syntax:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>first-benchmark</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>phases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>listVehicles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>constantRate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>fetchIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>seeDetails</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>constantRate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>fetchDetails</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/offering/1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>When you <code>upload</code> and <code>run</code> the benchmark you can see that both phases are running in parallel. Now try to schedule them one after another: In CLI, type <code>edit first-benchmark</code> and in the editor (vim) go to the <code>seeDetails</code> phase and add <code>startAfter: listVehicles</code> property to the phase. Save the file and quit the editor using the usual <code>:wq</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>seeDetails</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>constantRate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>startAfter</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>listVehicles</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>#     ...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Run the benchmark again and see that this time the phases executed one after another (check the start and completion timestamps):</p><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>NAME          STATUS      STARTED       REMAINING  COMPLETED     TOTAL DURATION               DESCRIPTION
listVehicles  TERMINATED  10:10:12.650             10:10:22.654  10004 ms (exceeded by 4 ms)  10.00 users per second
seeDetails    TERMINATED  10:10:22.652             10:10:32.654  10002 ms (exceeded by 2 ms)  10.00 users per second
</code></pre><p>Note that <code>edit</code> does not modify the file in <code>/benchmarks/</code>; Hyperfoil controller stores benchmark definitions and you are updating the benchmark there (CLI automatically downloads it and re-uploads when the editor is closed).</p><h2 id=forks>Forks<a class=td-heading-self-link href=#forks aria-label="Heading self-link"></a></h2><p>The benchmark above was somewhat too verbose as the two phases (running in parallel) used the same setup. For those that don&rsquo;t like to repeat themselves there&rsquo;s an alternative way to execute two different scenarios: <code>forks</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>first-benchmark</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>phases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>main</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>constantRate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>forks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>listVehicles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>fetchIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>seeDetails</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>fetchDetails</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/offering/1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Notice that we&rsquo;ve increased the <code>usersPerSec</code> rate from 10 to 30. The user arrival rate is then distributed according to the <code>weight</code> of the fork, therefore <code>listVehicles</code> got 20 users/s and <code>seeDetails</code> got 10:</p><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>PHASE              METRIC        THROUGHPUT   REQUESTS  MEAN     p50      p90      p99      p99.9    p99.99   2xx  3xx  4xx  5xx  CACHE  TIMEOUTS  ERRORS  BLOCKED
main/listVehicles  fetchIndex    19.40 req/s       194  2.11 ms  2.16 ms  2.39 ms  3.65 ms  3.87 ms  3.87 ms  194    0    0    0      0         0       0     0 ns
main/seeDetails    fetchDetails  11.00 req/s       110  3.45 ms  3.47 ms  3.72 ms  4.82 ms  5.64 ms  5.64 ms  110    0    0    0      0         0       0     0 ns
</code></pre><p>Internally we&rsquo;ve created two phases (actually there&rsquo;s one more, see more about <a href=/userguide/benchmark/phases.html>phases</a>) and named them <code>main/listVehicles</code> and <code>main/seeDetails</code>.</p><p>The benchmark above does not have any warm-up nor ramp-up. Let&rsquo;s add one, as a phase. However, we don&rsquo;t want to repeat ourselves copypasting the scenarios or forks. Let&rsquo;s use YAML anchors for that:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>first-benchmark</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>phases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>main</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>constantRate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>startAfter</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rampup</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>forks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>listVehicles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>&amp;listVehicles</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>fetchIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>seeDetails</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>&amp;seeDetails</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>fetchDetails</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/offering/1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>rampup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>increasingRate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>initialUsersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>targetUsersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>forks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>listVehicles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>*listVehicles</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>seeDetails</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>*seeDetails</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>We have marked each fork with an unique identifier (<code>listVehicle</code> and <code>seeDetails</code>) (the anchor matches to the fork name but that&rsquo;s not a requirement) using <code>&</code> anchor. Then we have added the <code>rampup</code> phase that gradually increases the load from 3 to 30 users per second and reused the definitions using alias <code>*</code>. This is a standard YAML feature and your editor should understand it; Hyperfoil interprets it by cloning the definition of the fork. You can use this at multiple levels: for forks, scenarios or sequences.</p><h2 id=building-the-scenario>Building the scenario<a class=td-heading-self-link href=#building-the-scenario aria-label="Heading self-link"></a></h2><p>There&rsquo;s more to phases and we suggest going through <a href=/quickstart/quickstart4.html>the quickstarts</a>, but let&rsquo;s move to another topic: the scenarios themselves. So far we&rsquo;ve been hitting only two static resources, the root and one offering. Let&rsquo;s get back to the very first example and add some randomization:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>first-benchmark</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>fetchDetails</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>randomInt</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>min</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>toVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>offering</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/offering/${offering}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>We have extended the <code>fetchDetails</code> sequence to two steps. In the first step <a href=/docs/steps/step_randomInt.html>randomInt</a> we generate a random integer between 1 and 100 (inclusive) and store that in the <em>user session</em> under the key <code>offering</code>. Each virtual user has its own session that defines the state of the scenario and keeps all the session variables. Consider using <a href=/userguide/benchmark/scenario.html>initialSequences</a> to ensure session variables are populated. In the second step <a href=/docs/steps/step_httpRequest.html>httpRequest</a> we specify the path for a GET request using a template interpolating <code>${offering}</code> into the value of the variable.</p><p>If you execute the request using web browser with a network monitor you&rsquo;ll find out that it&rsquo;s not just the document located at <code>http://localhost:8080/offering/1</code> it is fetching. There&rsquo;s also images, scripts and CSS. Hyperfoil offers an <a href=/2020/11/16/fetch-embedded.html>easy-to-use option</a> to download resources fetched from the HTML page:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>first-benchmark</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>fetchDetails</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>randomInt</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>min</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>toVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>offering</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/offering/${offering}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>handler</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>body</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>parseHtml</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>onEmbeddedResource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>fetchResource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>maxResources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>After uploading and running this you can check out <code>stats</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>hyperfoil@in-vm<span style=color:#ce5c00;font-weight:700>]</span>$ stats
</span></span><span style=display:flex><span>Total stats from run <span style=color:#0000cf;font-weight:700>0024</span>
</span></span><span style=display:flex><span>PHASE  METRIC                               THROUGHPUT   REQUESTS  MEAN      p50       p90       p99       p99.9     p99.99    2xx  3xx  4xx  5xx  CACHE  TIMEOUTS  ERRORS  BLOCKED
</span></span><span style=display:flex><span>main   /config                              12.20 req/s       <span style=color:#0000cf;font-weight:700>122</span>  14.64 ms  12.19 ms  34.08 ms  41.68 ms  50.07 ms  50.07 ms  <span style=color:#0000cf;font-weight:700>122</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>      <span style=color:#0000cf;font-weight:700>0</span>         <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span> ns
</span></span><span style=display:flex><span>main   /favicon.ico                         12.20 req/s       <span style=color:#0000cf;font-weight:700>122</span>   9.70 ms   5.21 ms  19.53 ms  29.75 ms  37.75 ms  37.75 ms  <span style=color:#0000cf;font-weight:700>122</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>      <span style=color:#0000cf;font-weight:700>0</span>         <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span> ns
</span></span><span style=display:flex><span>main   /manifest.json                       12.20 req/s       <span style=color:#0000cf;font-weight:700>122</span>   7.39 ms   4.39 ms  15.73 ms  27.39 ms  34.87 ms  34.87 ms  <span style=color:#0000cf;font-weight:700>122</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>      <span style=color:#0000cf;font-weight:700>0</span>         <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span> ns
</span></span><span style=display:flex><span>main   /static/css/2.0720d3cf.chunk.css     12.20 req/s       <span style=color:#0000cf;font-weight:700>122</span>  18.27 ms  12.32 ms  33.82 ms  40.37 ms  41.42 ms  41.42 ms  <span style=color:#0000cf;font-weight:700>122</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>      <span style=color:#0000cf;font-weight:700>0</span>         <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span>  139.48 ms
</span></span><span style=display:flex><span>main   /static/css/main.7fcb1519.chunk.css  12.20 req/s       <span style=color:#0000cf;font-weight:700>122</span>  17.04 ms  11.99 ms  33.82 ms  38.54 ms  40.11 ms  40.11 ms  <span style=color:#0000cf;font-weight:700>122</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>      <span style=color:#0000cf;font-weight:700>0</span>         <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span>  149.66 ms
</span></span><span style=display:flex><span>main   /static/js/2.256a11d3.chunk.js       12.20 req/s       <span style=color:#0000cf;font-weight:700>122</span>  25.66 ms  19.66 ms  43.25 ms  50.07 ms  67.11 ms  67.11 ms  <span style=color:#0000cf;font-weight:700>122</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>      <span style=color:#0000cf;font-weight:700>0</span>         <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span>  148.54 ms
</span></span><span style=display:flex><span>main   /static/js/main.656b4a9d.chunk.js    12.20 req/s       <span style=color:#0000cf;font-weight:700>122</span>  24.93 ms  20.05 ms  42.99 ms  51.64 ms  66.85 ms  66.85 ms  <span style=color:#0000cf;font-weight:700>122</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>      <span style=color:#0000cf;font-weight:700>0</span>         <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span>  121.88 ms
</span></span><span style=display:flex><span>main   fetchDetails                         12.20 req/s       <span style=color:#0000cf;font-weight:700>122</span>   5.41 ms   2.06 ms  10.68 ms  41.68 ms  41.68 ms  41.68 ms  <span style=color:#0000cf;font-weight:700>122</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>      <span style=color:#0000cf;font-weight:700>0</span>         <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span> ns
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>main//static/css/2.0720d3cf.chunk.css: Progress was blocked waiting <span style=color:#204a87;font-weight:700>for</span> a free connection. Hint: increase http.sharedConnections.
</span></span><span style=display:flex><span>main//static/css/main.7fcb1519.chunk.css: Progress was blocked waiting <span style=color:#204a87;font-weight:700>for</span> a free connection. Hint: increase http.sharedConnections.
</span></span><span style=display:flex><span>main//static/js/2.256a11d3.chunk.js: Progress was blocked waiting <span style=color:#204a87;font-weight:700>for</span> a free connection. Hint: increase http.sharedConnections.
</span></span><span style=display:flex><span>main//static/js/main.656b4a9d.chunk.js: Progress was blocked waiting <span style=color:#204a87;font-weight:700>for</span> a free connection. Hint: increase http.sharedConnections.
</span></span></code></pre></div><p>When running this in CLI you&rsquo;d see that four of these metrics would be printed in red color and have a non-zero number in the <strong>BLOCKED</strong> column. This is happening because with more HTTP requests being sent, it&rsquo;s quite likely that one user starts before a previous user has received all the responses.</p><p>With HTTP 1.1 (pipelining disabled by default) and only 10 connections there would not be enough available connections and the virtual user couldn&rsquo;t send the request right away. This wouldn&rsquo;t happen to a real user - that one is not limited by other users. Had we allowed a feedback from the server (taking few moments to respond) our latency readings could be dramatically skewed. This is why Hyperfoil warns us that the benchmark wasn&rsquo;t 100% correct and hints us to increase number of connections.</p><p>Alternatively we could switch to HTTP 2 that supports multiplexing several requests over single connection.</p><h2 id=to-be-continued>To be continued&mldr;<a class=td-heading-self-link href=#to-be-continued aria-label="Heading self-link"></a></h2><p>Comparing the requests to a browser&rsquo;s network monitor we&rsquo;ve omitted the call to <code>http://localhost:8082/offering/${offering}</code> (executed from script) and loading images from <code>http://localhost:8080/images/car?...</code>. We will cover that in the <a href=/blog/news/2021-02-09-hf-beginner-guide-2/>next part</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8c654f0ee650a6a2e901c6d63171c237>Beginner's Guide to Hyperfoil: part 2</h1><div class=lead>In this post we will focus on processing of responses and user workflow through the site.</div><div class="td-byline mb-4"><time datetime=2021-01-25 class=text-body-secondary>Monday, January 25, 2021</time></div><blockquote><p>This article is intended to be published on other sites, too - therefore it contains introduction to concepts this blog’s readers are probably familiar with.</p></blockquote><p>In the <a href=/blog/news/2021-01-25-hf-beginner-guide-1/>previous part</a> we&rsquo;ve deployed our demo application (Vehicle Market) and exercised some basic requests against that. In this post we will focus on processing responses and user workflow through the site.</p><h2 id=processing-responses>Processing responses<a class=td-heading-self-link href=#processing-responses aria-label="Heading self-link"></a></h2><p>We will start with a benchmark that fetches single random page with an offering, without the HTML resources part for brevity:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>first-benchmark</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>fetchDetails</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>randomInt</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>min</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>toVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>offering</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/offering/${offering}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>We have investigated what a browser would do, and found out that this page executes a request against <code>http://localhost:8082/offering/${offering}</code> to fetch a JSON document. Notice the different port <code>8082</code>: we will need to add another endpoint to the configuration and start selecting the endpoint in <code>httpRequest</code> steps:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>vehicle-market</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8082</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>fetchWebpage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>randomInt</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>min</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>toVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>offering</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/offering/${offering}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>authority</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>fetchJson</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/offering/${offering}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>authority</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>localhost:8082</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>We have added the another sequence <code>fetchJson</code> with a second request. When the <code>scenario</code> contains the sequences as a list these are executed in-order; the second sequence is not started until the last step from the previous one completes. While you could keep both requests in one sequence, the sequence name is used as the default name for the metric. Therefore a metric with the same name would be reported twice. Moving the request to its own sequence solves the problem.</p><p>After receiving the JSON the script would modify the DOM and add images referenced in the JSON. Let&rsquo;s replicate that in our benchmark:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>vehicle-market</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8082</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>orderedSequences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>fetchWebpage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>randomInt</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>min</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>toVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>offering</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/offering/${offering}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>authority</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>fetchJson</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/offering/${offering}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>authority</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>localhost:8082</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>handler</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>body</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>json</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>query</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>.gallery[].url</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>toArray</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gallery[10]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>foreach</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>fromVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gallery</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>sequence</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>fetchImage</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>counterVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>numImages</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>awaitInt</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>var</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>numImages</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>equalTo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sequences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>fetchImage[10]</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${ gallery[.] }</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>authority</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>sync</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>handler</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>onCompletion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>addToInt</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>numImages--</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The scenario does not host a simple list of sequences anymore; we have moved the original sequences under <code>orderedSequences</code> and added another section <code>sequences</code> with sequence <code>fetchImage</code>. The scenario starts with one instance of <code>fetchWebpage</code>, when this completes a single instance of <code>fetchJson</code> is created. There are no <code>fetchImage</code> instances at the beginning - <code>sequences</code> hosts only definitions but does not create any instances. For details see <a href=/docs/user-guide/benchmark/scenario/>documentation</a></p><p>In the request in <code>fetchJson</code> we have registered a handler for response body; This handler applies the <code>.gallery[].url</code> query and stores the URLs in an array stored in the session variable <code>gallery</code>. This array has 10 slots; as any other resource in Hyperfoil scenario this array is pre-allocated before the benchmark starts. Therefore we need to limit the size - if there are more images than slots the other URLs are simply discarded.</p><p>In the second step in <code>fetchJson</code> the <code>gallery</code> array is scanned by the <a href=/docs/reference/steps/step_foreach>foreach</a> step. For each item in the array this steps creates a new instance of the <code>fetchImage</code> sequence. The <code>[10]</code> next to the sequence name means that there can be at most 10 instances of <code>fetchImage</code> running concurrently. The number of created sequences is then recorded into variable <code>numImages</code>.</p><blockquote><p>In fact the <code>foreach</code> step stops scanning the array when it finds an unset slot - gaps in the array are not supported. This is irrelevant for our scenario, though - the <code>toArray</code> fills the array from the start without gaps.</p></blockquote><p>The last step in the <code>fetchJson</code> sequence is not necessary for our scenario (it would be complete after downloading all the images) but shows how to synchronize after all the images are retrieved. In the <code>awaitInt</code> step we are blocking the completion of the sequence until <code>numImages</code> drops to zero. The counter is decremented after the response with the image is fully received (<code>onCompletion</code> handler) using action <a href=/docs/reference/steps/action_addToInt>addToInt</a>.</p><p>We have not explained the notation <code>gallery[.]</code> in the path template fetching the image yet. The <code>[.]</code> is called sequence-scoped access: addressing an array with current sequence index. When <code>foreach</code> creates new instances of the same sequence each will get a distinct index (lowest available) that it can use to read/write its private data. Indices for different sequences are not coordinated, though.</p><h2 id=login-workflow>Login workflow<a class=td-heading-self-link href=#login-workflow aria-label="Heading self-link"></a></h2><p>Now that you know how to process responses, let&rsquo;s have a look on another very common part of user workflow: authentication. We&rsquo;d like to simulate user visiting the front page, clicking on the Login button and filing out the credentials, possibly multiple times to simulate fat fingers.</p><p>You need to get list of valid user credentials; Vehicle Market holds a copy of these (regular authentication flow uses hashed passwords) and you can get the list running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl localhost:8083/user-loader &gt; /tmp/credentials.csv
</span></span></code></pre></div><p>Here is the benchmark:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>login</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Frontend</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># User service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8083</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>orderedSequences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>fetchIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>authority</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>randomInt</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>min</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>toVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>failedAttempts</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>randomCsvRow</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>file</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/tmp/credentials.csv</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>removeQuotes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>columns</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>0</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>username</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>password</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>wrongLogin</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>breakSequence</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>intCondition</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>fromVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>failedAttempts</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>equalTo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>onBreak</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>newSequence</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>successfulLogin</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>POST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/login</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>authority</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>localhost:8083</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>body</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>form</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>username</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>fromVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>username</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>password</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>th1sIsMy$EcretPa55W%rD</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>handler</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>autoRangeCheck</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>addToInt</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>failedAttempts--</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>nextSequence</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>wrongLogin</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sequences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>successfulLogin</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>POST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/login</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>authority</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>localhost:8083</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>body</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>form</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>username</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>fromVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>username</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>password</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>fromVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>password</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>There&rsquo;s nothing extraordinary in the first sequence, <code>fetchIndex</code> - we retrieve the landing page and decide if we should provide the correct credentials right away or have 1 or 2 failed attempts. We also select credentials using the <code>randomCsvRow</code> step. This step picks a random row from a CSV-formatted file, and stores the values into variables. In our case we pick the first column (columns are indexed starting from zero) into variable <code>username</code> and second into <code>password</code>.</p><p>After this we automatically jump to the <code>wrongLogin</code> sequence (even if we&rsquo;re not supposed to use wrong credentials). The first step there is the conditional <code>breakSequence</code> step: this step can terminate execution of its sequence prematurely (subsequent steps are not executed) and execute one or more actions. In <code>onBreak</code> we use the <code>newSequence</code> action that creates a new instance of sequence <code>successfulLogin</code>.</p><p>If the condition does not hold the execution of <code>wrongLogin</code> continues with the well known <code>httpRequest</code> step. This time we are firing a POST request, with a request body that will simulate a submitted HTML form. Hyperfoil will automatically add the <code>Content-Type: application/x-www-form-urlencoded</code> header and URL-encode the variables should there be any special characters. In this instance we&rsquo;re using a constant value for the password that should not match any actual user password.</p><p>By default Hyperfoil adds <a href=/docs/reference/steps/step_httpRequest#handler>handlers</a> that will mark the response as invalid and stop session execution when the response status is not between 200 and 399. We&rsquo;re expecting a 401 response with invalid credentials and therefore we disable this default behaviour by setting <code>autoRangeCheck: false</code> (we don&rsquo;t need to disable the other handler, <code>stopOnInvalid</code>). Note that this behaviour can be also set globally in <a href=/docs/user-guide/benchmark/ergonomics/>ergonomics</a>.</p><p>After receiving the response (the request is synchronous) we decrement the number of failed attempts by 1 using the <a href=/docs/reference/steps/step_addToInt>addToInt</a> step with shorthand syntax. We have used the <code>addToInt</code> action in the previous example: all actions can be used as steps, though steps (such as <code>httpRequest</code>) cannot be used as an action. This is not possible because a step can block sequence execution (waiting for an available connection, or until a variable is set&mldr;) but an action runs and completes without any delay - this is the main difference between those.</p><p>The last step is the <code>nextSequence</code> step (similar to the <code>newSequence</code> action) creating a new instance of the <code>wrongLogin</code> sequence. This step can be used anywhere in a sequence if it creates a different sequence or the sequence has sufficient concurrency limit (we had that <code>fetchImage[10]</code> in the previous example) - however had we added another step after it we would need two instances of <code>wrongLogin</code> running concurrently and the sequence is not marked as concurrent. When we place this as the last step there is a special case when the step only restarts current sequence, not requiring additional concurrent instance.</p><p>The <code>successfulLogin</code> sequence does not require much comment, it issues the same request as <code>wrongSequence</code>, only correctly picking the password from session variable. Let&rsquo;s have a look on the results:</p><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>PHASE  METRIC           THROUGHPUT   REQUESTS  MEAN     p50      p90       p99       p99.9     p99.99    2xx  3xx  4xx  5xx  CACHE  TIMEOUTS  ERRORS  BLOCKED
main   fetchIndex       10.00 req/s       100  2.74 ms  3.01 ms   4.08 ms   4.85 ms   4.85 ms   4.85 ms  100    0    0    0      0         0       0     0 ns
main   successfulLogin  10.00 req/s       100  7.75 ms  8.32 ms  10.49 ms  11.53 ms  11.67 ms  11.67 ms  100    0    0    0      0         0       0     0 ns
main   wrongLogin        9.30 req/s        93  4.16 ms  4.98 ms   5.83 ms   6.98 ms   6.98 ms   6.98 ms    0    0   93    0      0         0       0     0 ns
</code></pre><p>We can now see 2xx responses for <code>successfulLogin</code> and 4xx responses for <code>wrongLogin</code> as we expect. Also the response times for a successful login are somewhat higher, maybe because the server stores a new token in the database.</p><p>Looking at browser network log we can see that the web-page captures this token and fetches user profile using that (it will also use this token in the <code>Authorization</code> header when talking to other services). Let&rsquo;s add this to our test, and one more thing: while Hyperfoil can send another login request almost immediately your users would need some time to type these. Therefore we are going to add some user think time:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>login</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Frontend</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># User service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8083</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>orderedSequences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>fetchIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>authority</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>randomInt</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>min</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>toVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>failedAttempts</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>randomCsvRow</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>file</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/tmp/credentials.csv</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>removeQuotes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>columns</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>0</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>username</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>password</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>thinkTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>2s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>wrongLogin</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>breakSequence</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>intCondition</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>fromVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>failedAttempts</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>equalTo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>onBreak</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>newSequence</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>successfulLogin</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>POST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/login</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>authority</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>localhost:8083</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>body</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>form</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>username</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>fromVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>username</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>password</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>th1sIsMy$EcretPa55W%rD</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>handler</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>autoRangeCheck</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>addToInt</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>failedAttempts--</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>thinkTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>2s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>random</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NEGATIVE_EXPONENTIAL</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>min</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>500</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ms</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>nextSequence</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>wrongLogin</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sequences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>successfulLogin</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>POST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/login</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>authority</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>localhost:8083</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>body</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>form</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>username</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>fromVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>username</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>password</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>fromVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>password</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>handler</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>body</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>store</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>token</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>nextSequence</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fetchProfile</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>fetchProfile</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/info?token=${urlencode:token}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>authority</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>localhost:8083</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>We have added constant 2-second pause as the last step of <code>fetchIndex</code>, and another pause into <code>wrongLogin</code> using <a href=https://en.wikipedia.org/wiki/Exponential_distribution>negative-exponential distribution</a> with expected average of 2 seconds but ranging from 500 ms to 10 seconds (the actual average will be about 2044 ms due to these limits).</p><p>Then we have added a simple body handler to the successful login request, storing the value in session variable <code>token</code>, and a <code>nextSequence</code> step to the <code>successfulLogin</code> sequence that will start the <code>fetchProfile</code> sequence with single <code>httpRequest</code>. You can notice that we had to use a new notation in the pattern: <code>${urlencode:token}</code>. While pasting numbers into the request path is fine, a token might contain special symbols (such as +), and we need to URL-encode those. Contrary to the form used in the <code>successfulLogin</code> Hyperfoil cannot run the encoding automatically for you since it can&rsquo;t know if the session variable contents is already URL-encoded (e.g. if you fetched an existing URL into that).</p><p>Let&rsquo;s run this and see the output of <code>stats</code> command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>PHASE  METRIC           THROUGHPUT  REQUESTS  MEAN      p50       p90       p99       p99.9     p99.99    2xx  3xx  4xx  5xx  CACHE  TIMEOUTS  ERRORS  BLOCKED
</span></span><span style=display:flex><span>main   fetchIndex       1.59 req/s        <span style=color:#0000cf;font-weight:700>35</span>   4.24 ms   3.54 ms   5.73 ms  13.83 ms  13.83 ms  13.83 ms   <span style=color:#0000cf;font-weight:700>35</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>      <span style=color:#0000cf;font-weight:700>0</span>         <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span>     <span style=color:#0000cf;font-weight:700>0</span> ns
</span></span><span style=display:flex><span>main   fetchProfile     1.59 req/s        <span style=color:#0000cf;font-weight:700>35</span>   5.15 ms   4.69 ms   6.52 ms  22.68 ms  22.68 ms  22.68 ms   <span style=color:#0000cf;font-weight:700>35</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>      <span style=color:#0000cf;font-weight:700>0</span>         <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span>     <span style=color:#0000cf;font-weight:700>0</span> ns
</span></span><span style=display:flex><span>main   successfulLogin  1.59 req/s        <span style=color:#0000cf;font-weight:700>35</span>  11.11 ms  10.75 ms  14.81 ms  36.96 ms  36.96 ms  36.96 ms   <span style=color:#0000cf;font-weight:700>35</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>      <span style=color:#0000cf;font-weight:700>0</span>         <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span>     <span style=color:#0000cf;font-weight:700>0</span> ns
</span></span><span style=display:flex><span>main   wrongLogin       1.27 req/s        <span style=color:#0000cf;font-weight:700>28</span>   5.27 ms   5.44 ms   6.95 ms   7.44 ms   7.44 ms   7.44 ms    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>   <span style=color:#0000cf;font-weight:700>28</span>    <span style=color:#0000cf;font-weight:700>0</span>      <span style=color:#0000cf;font-weight:700>0</span>         <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span>     <span style=color:#0000cf;font-weight:700>0</span> ns
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>main/fetchIndex: Exceeded session limit
</span></span><span style=display:flex><span>main/fetchProfile: Exceeded session limit
</span></span><span style=display:flex><span>main/successfulLogin: Exceeded session limit
</span></span><span style=display:flex><span>main/wrongLogin: Exceeded session limit
</span></span></code></pre></div><p>In a colorful CLI you&rsquo;d see all the lines in red and some errors listed below: &ldquo;Exceeded session limit&rdquo;, and we did not run all the ~100 index page hits. What happened?</p><p>Hyperfoil has a fixed limit for concurrency - number of virtual users (sessions) executed in parallel. By default this limit is equal to user arrival rate (<code>usersPerSec</code>), so in this scenario it was 10 concurrent users. However as with all those think-times the session takes several seconds, we will require more than 10 concurrent sessions, even if the virtual users are idle in their think-time. Average session should take 4 seconds pausing plus some time for the requests, so we can expect little over 40 concurrent users. We&rsquo;ll add some margin and raise the limit to 60 sessions using the <code>maxSessions</code> property:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>login</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8083</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>maxSessions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>60</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># ...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>After running this we&rsquo;ll take a look on stats:</p><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>PHASE  METRIC           THROUGHPUT  REQUESTS  MEAN     p50      p90       p99       p99.9     p99.99    2xx  3xx  4xx  5xx  CACHE  TIMEOUTS  ERRORS  BLOCKED
main   fetchIndex       4.46 req/s       106  2.58 ms  2.56 ms   3.88 ms   6.46 ms  10.03 ms  10.03 ms  106    0    0    0      0         0       0     0 ns
main   fetchProfile     4.46 req/s       106  3.44 ms  3.52 ms   4.46 ms   7.01 ms   9.90 ms   9.90 ms  106    0    0    0      0         0       0     0 ns
main   successfulLogin  4.46 req/s       106  8.47 ms  8.36 ms  11.40 ms  15.07 ms  28.70 ms  28.70 ms  106    0    0    0      0         0       0     0 ns
main   wrongLogin       4.92 req/s       117  4.12 ms  4.33 ms   4.98 ms  14.48 ms  28.70 ms  28.70 ms    0    0  117    0      0         0       0     0 ns
</code></pre><p>There are no errors and the request numbers are as expected. The throughput is somewhat off because the total duration of the phase was several seconds past - Hyperfoil starts the sessions within the configured 10 seconds, then the phase moves to a <code>FINISHED</code> state but it won&rsquo;t complete (state <code>TERMINATED</code>) until all sessions don&rsquo;t execute its last step and receive response for the last request.</p><p>We can also take a look on number of sessions running concurrently using the <code>sessions</code> command in the CLI:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>hyperfoil@in-vm<span style=color:#ce5c00;font-weight:700>]</span>$ sessions
</span></span><span style=display:flex><span>Run 003E has terminated.
</span></span><span style=display:flex><span>PHASE  AGENT  MIN  MAX
</span></span><span style=display:flex><span>main   in-vm    <span style=color:#0000cf;font-weight:700>1</span>   <span style=color:#0000cf;font-weight:700>53</span>
</span></span></code></pre></div><p>Our guess that we&rsquo;ll need 60 concurrent sessions was not too far off as at one moment we had 53 sessions running concurrently. You can also run this command when the test is being executed to see actual number of sessions rather than grand total for the whole phase.</p><p>This concludes our second blog post with a deep dive into complex scenarios. In the <a href=/blog/news/2021-02-16-hf-beginner-guide-3/>next article</a> we&rsquo;ll go through setting Hyperfoil up in an OpenShift cluster.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-cb9528e41fcdc1ef2ebe9f7790cd9590>Beginner's Guide to Hyperfoil: part 3</h1><div class=lead>In this article we&rsquo;ll show how to run Hyperfoil inside an Openshift cluster, benchmarking workload within the same cluster.</div><div class="td-byline mb-4"><time datetime=2021-01-25 class=text-body-secondary>Monday, January 25, 2021</time></div><p>In this article we&rsquo;ll show how to run Hyperfoil inside an Openshift cluster, benchmarking workload within the same cluster. This assumes that you have sufficient privileges to install operators and create new namespaces (projects).</p><h2 id=demo-workload>Demo workload<a class=td-heading-self-link href=#demo-workload aria-label="Heading self-link"></a></h2><p>We will install <a href=https://github.com/Hyperfoil/vehicle-market>Vehicle Market</a>, our demo application we&rsquo;ve used in the <a href=/blog/news/2021-01-25-hf-beginner-guide-1/>first article</a> using console and Openshift Template.</p><p>Login into your cluster and run this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Fetch the default domain your cluster uses</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>DOMAIN</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>oc get ingresscontrollers.operator.openshift.io <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    -n openshift-ingress-operator default -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{ .status.domain }&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span>oc new-project vehicle-market
</span></span><span style=display:flex><span>curl -Ls http://vehicle-market-template.hyperfoil.io <span style=color:#000;font-weight:700>|</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    oc process -f - -p <span style=color:#000>DOMAIN</span><span style=color:#ce5c00;font-weight:700>=</span>vehicle-market.<span style=color:#000>$DOMAIN</span> <span style=color:#000;font-weight:700>|</span> oc apply -f -
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> http://vehicle-market.<span style=color:#000>$DOMAIN</span>
</span></span></code></pre></div><p>This will deploy 5 pods, 5 services and 4 routes in the <code>vehicle-market</code> namespace, and load some example data. You can open the URL printed as the last line in your browser and explore the application.</p><h2 id=installing-hyperfoil>Installing Hyperfoil<a class=td-heading-self-link href=#installing-hyperfoil aria-label="Heading self-link"></a></h2><p>You can install Hyperfoil Operator either through web-console, or on command-line using <code>oc</code>. For the web-console installation switch to the &lsquo;Administrator view&rsquo; and go to Operators/OperatorHub. Filter &lsquo;Hyperfoil&rsquo; and you should see the operator:</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:657px><img class=card-img-top src=/hyperfoil-website-demo/blog/news/2021-02-16-hf-beginner-guide-3/hf-beginner-guide-3-operator_hu07389b452c7d12b1f97260a45575da58_64003_1800x450_fit_catmullrom_3.png width=647 height=450><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text></p></figcaption></figure><p>Click on Hyperfoil and go through the wizard with all settings on default values (install to all namespaces with automatic approval).</p><p>Alternatively you can create the subscription by defining this subscription:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operators.coreos.com/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Subscription</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hyperfoil-operator</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>openshift-operators</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>channel</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>alpha</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hyperfoil-bundle</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>source</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>community-operators</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sourceNamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>openshift-marketplace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In any case you should end up with Hyperfoil listed amongst the installed operators:</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:710px><img class=card-img-top src=/hyperfoil-website-demo/blog/news/2021-02-16-hf-beginner-guide-3/hf-beginner-guide-3-installed_hu71272aa5edec3e62c99356bae20591fb_14360_700x200_fit_catmullrom_3.png width=700 height=73><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text></p></figcaption></figure><p>Now you can create a new namespace for Hyperfoil and add the custom resource. In web-console open the dropdown on top and create a new namespace <code>hyperfoil</code>. When the page reloads with all operators (that can take a couple of seconds) click on &lsquo;Hyperfoil&rsquo; in the Provided APIs column (highlighted with red ellipse above). Press the &lsquo;Create Hyperfoil&rsquo; button on the right side and switch to YAML View, filling the definition below and push &lsquo;Create&rsquo; button below the editor.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hyperfoil.io/v1alpha2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Hyperfoil</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hyperfoil</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>route</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hyperfoil.apps.your.domain.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The only non-default value in this example is the hostname for the route; default hostname would be probably a bit longer. By default the route uses edge termination (the TLS connection is terminated at the router, the communication inside cluster is not encrypted). Therefore we will be connecting to port 443.</p><p>On command line just use commands below, passing the CR above as <code>hyperfoil.yaml</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc new-project hyperfoil
</span></span><span style=display:flex><span>$ oc apply -f hyperfoil.yaml
</span></span><span style=display:flex><span>$ oc get hf
</span></span><span style=display:flex><span>NAME        VERSION   ROUTE                            PVC   STATUS
</span></span><span style=display:flex><span>hyperfoil             hyperfoil.apps.your.domain.com         Ready
</span></span></code></pre></div><h2 id=using-hyperfoil>Using Hyperfoil<a class=td-heading-self-link href=#using-hyperfoil aria-label="Heading self-link"></a></h2><p>Now it&rsquo;s time to open CLI as we&rsquo;ve done in the previous articles:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>VMB</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$HOME</span>/vehicle-market/benchmarks
</span></span><span style=display:flex><span>podman run -it --rm -v <span style=color:#000>$VMB</span>:/benchmarks:Z -v /tmp/reports:/tmp/reports:Z <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --network<span style=color:#ce5c00;font-weight:700>=</span>host quay.io/hyperfoil/hyperfoil cli
</span></span></code></pre></div><br>```sh
[hyperfoil]$ connect hyperfoil.apps.your.domain.com:443
ERROR: javax.net.ssl.SSLHandshakeException: Failed to create SSL connection: Failed to create SSL connection: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target: unable to find valid certification path to requested target
Hint: TLS certificate verification might have failed. Use --insecure to disable validation.
Failed connecting to hyperfoil.apps.your.domain.com:443
```<p>We are connecting to the route on port 443 (you could also use <code>connect https://hyperfoil.apps.your.domain.com</code> or <code>connect hyperfoi.apps.your.domain.com -p 443</code>) but the certificate issued by the router might not be valid if this is not a production cluster. Use <code>--insecure</code> (or <code>-k</code>) in that case:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>hyperfoil<span style=color:#ce5c00;font-weight:700>]</span>$ connect hyperfoil.apps.ocp.scalelab:443 -k
</span></span><span style=display:flex><span>WARNING: Hyperfoil TLS certificate validity is not checked. Your credentials might get compromised.
</span></span><span style=display:flex><span>Connected!
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>hyperfoil@hyperfoil<span style=color:#ce5c00;font-weight:700>]</span>$ upload /benchmarks/first-benchmark.hf.yaml
</span></span><span style=display:flex><span>Loaded benchmark first-benchmark, uploading...
</span></span><span style=display:flex><span>... <span style=color:#204a87;font-weight:700>done</span>.
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>hyperfoil@hyperfoil<span style=color:#ce5c00;font-weight:700>]</span>$ run
</span></span><span style=display:flex><span>ERROR: Server responded with unexpected code: 403, Forbidden:
</span></span><span style=display:flex><span>Server is started in clustered mode<span style=color:#000;font-weight:700>;</span> benchmarks must define agents.
</span></span><span style=display:flex><span>Failed to start benchmark first-benchmark
</span></span></code></pre></div><p>Oops, what happened now? We have tried to execute the benchmark from Part 1 that worked just fine when executed from <code>start-local</code>. The controller in Openshift is started in a clustered mode, though, and single-vm runs are prohibited. We need to tell Hyperfoil to run this benchmark using an agent - and the controller will spin up another pod that will fire the load.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>clustered-benchmark</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>agents</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>agent-one</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>agent-two</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://vehicle-market.apps.your.domain.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>120s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>fetchIndex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Besides adding the agents (with empty definition) we have corrected the endpoint hostname and increased duration to 2 minutes. While the benchmark is running you can verify that controller created another pod:</p><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>$ oc get pods -n hyperfoil
NAME                   READY   STATUS    RESTARTS   AGE
agent-0001-agent-one   1/1     Running   0          13s
agent-0001-agent-two   1/1     Running   0          13s
hyperfoil-controller   1/1     Running   0          17m
</code></pre><p>Both the <code>sharedConnections</code> and <code>usersPerSec</code> have been evenly distributed between the two agents; each will use 5 connections and run 5 users per second.</p><p>See the <a href=/docs/user-guide/benchmark/agents/#kubernetesopenshift-deployer>agents section documentation</a> for further customization of the agents.</p><p>Configuration options such as securing the controller with password, persistence, logging, hooks etc. can be found in the <a href=/docs/user-guide/installation/k8s/>installation guide</a>.</p><h2 id=webcli>WebCLI<a class=td-heading-self-link href=#webcli aria-label="Heading self-link"></a></h2><p>You are already familiar with Hyperfoil CLI but starting it up in Podman might not be the most convenient way (and neither is keeping Hyperfoil distribution locally). There’s an easy solution for that: just use your browser. Since Hyperfoil 0.14 the controller exposes a CLI — let’s navigate to <code>https://hyperfoil.apps.your.domain.com:</code></p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:696px><img class=card-img-top src=/hyperfoil-website-demo/blog/news/2021-02-16-hf-beginner-guide-3/hf-beginner-guide-3-webcli_hu00e0606dd427bdb51e5ddb18f1214233_26603_1800x200_fit_catmullrom_3.png width=686 height=200><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text></p></figcaption></figure><p>This CLI is automatically connected to the controller where it is running and cannot connect to any other controller (the command <code>connect</code> is missing, as well as <code>exit</code> and few other ones). Some commands are altered, e.g. <code>upload</code> cannot accept path on your machine while in browser — type just <code>upload</code> and then press a button that lets you select the benchmark file. <code>edit</code> does not open vi/vim/your favorite editor but displays a Monaco editor inside the browser. <code>export</code> and <code>report</code> cannot take <code>--destination</code>, instead these commands open download dialogue in the browser.</p><h2 id=tips-and-tricks>Tips and tricks<a class=td-heading-self-link href=#tips-and-tricks aria-label="Heading self-link"></a></h2><p><code>http://vehicle-market.apps.your.domain.com</code> is probably resolved to the load balancer that routes the traffic even before Openshift Ingresses. You might want to bypass this component, hitting the Ingresses directly. You can do that by setting addresses for the endpoints manually:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc get po -n openshift-ingress -o wide
</span></span><span style=display:flex><span>NAME                              READY   STATUS    RESTARTS   AGE   IP               NODE        NOMINATED NODE   READINESS GATES
</span></span><span style=display:flex><span>router-default-56b959876c-94x2f   1/1     Running   <span style=color:#0000cf;font-weight:700>1</span>          60d   192.168.222.19   worker006   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>router-default-56b959876c-9tqvb   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          60d   192.168.222.22   worker009   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://vehicle-market.apps.your.domain.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addresses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#0000cf;font-weight:700>192.168.222.19</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#0000cf;font-weight:700>192.168.222.22</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The connections will be randomly assigned to one of those IPs. You can also use bypass ingress completely and target the service directly - <code>addresses</code> can use hostnames and customize the actual port as well:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://vehicle-market.apps.your.domain.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addresses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>frontend.vehicle-market.svc.cluster.local:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-39804ef6b6d4482ec1284210c43dc6a0>Compensation for coordinated omission</h1><div class=lead>Measure true performance with Hyperfoil: compare actual and compensated latencies in closed-model benchmarks</div><div class="td-byline mb-4"><time datetime=2020-12-09 class=text-body-secondary>Wednesday, December 09, 2020</time></div><p>Results for <a href=/docs/user-guide/benchmark/phases/>closed-model</a> tests show maximum throughput your SUT can achieve; the response times are skewed though due to the coordinated omission. There are still cases where you&rsquo;d like to run in this mode and check the size of the error you&rsquo;re accumulating.</p><p>Many benchmarks use closed-model with fixed concurrency and cycle-time, expecting the request to be fired every X milliseconds. When the requests fall behind in schedule due to some requests taking more than this period (cycle-time) the subsequent requests are fired as quickly as possible to catch up. The &lsquo;compensated&rsquo; results estimate what would the latency be if you fired the requests on time. With open model the actual latencies could be the same (assuming that the previous request was delayed due waiting in a queue on server), better (the response was incidentally delayed on the network) or worse (the server queue would perform worse if hosting more requests).</p><p>Hyperfoil will tell you both values - the actually observed latencies AND the compensated estimate of latencies. You can use this mode only in <code>always</code> phases where you fix the cycle-time by providing a target rate of starting user sessions (contrary to the regular <code>always</code> behaviour starting user sessions as soon as possible). Note that the compensated time will be correct only if you don&rsquo;t execute any blocking steps before firing the request(s).</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://example.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>phases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>always</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>20s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>compensation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>targetRate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The test above uses 10 concurrent users and tries to run at 10 requests/s. Below you can see CLI listing from the <code>stats</code> command, showing mean response time of 113 ms (real) vs. 172 ms (compensated). In this case the difference is not caused by a responses taking more than 1 second (the cycle-time for each user) but because sending the request is blocked by lack of available connections (we are using only 2): see that the <code>BLOCKED</code> column says that requests have been blocked for more than 6 seconds waiting for a free connection.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>hyperfoil@in-vm<span style=color:#ce5c00;font-weight:700>]</span>$ stats
</span></span><span style=display:flex><span>Total stats from run <span style=color:#0000cf;font-weight:700>0025</span>
</span></span><span style=display:flex><span>PHASE  METRIC            THROUGHPUT  REQUESTS  MEAN       p50        p90        p99        p99.9      p99.99     2xx  3xx  4xx  5xx  CACHE  TIMEOUTS  ERRORS  BLOCKED
</span></span><span style=display:flex><span><span style=color:#204a87>test</span>   compensated-test  9.97 req/s       <span style=color:#0000cf;font-weight:700>208</span>  171.78 ms  148.90 ms  216.01 ms  641.73 ms  968.88 ms  968.88 ms    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>      <span style=color:#0000cf;font-weight:700>0</span>         <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span>     <span style=color:#0000cf;font-weight:700>0</span> ns
</span></span><span style=display:flex><span><span style=color:#204a87>test</span>   <span style=color:#204a87>test</span>              9.97 req/s       <span style=color:#0000cf;font-weight:700>208</span>  113.42 ms  103.28 ms  149.95 ms  312.48 ms  392.17 ms  392.17 ms  <span style=color:#0000cf;font-weight:700>208</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#0000cf;font-weight:700>0</span>      <span style=color:#0000cf;font-weight:700>0</span>         <span style=color:#0000cf;font-weight:700>0</span>       <span style=color:#0000cf;font-weight:700>0</span>  6.23 s
</span></span></code></pre></div><p>What happens underhood? You can see that using the <code>inspect</code> command in the CLI (some parts removed for brevity):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>initialSequences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>__delay-session-start</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>delaySessionStart</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>randomize</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>sequences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>targetRate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>targetRateIncrement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sequences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>beforeSyncRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>handler</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>completionHandlers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>releaseSync</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>compensatedResponseRecorder</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>metricSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>prefixMetricSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>delegate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>providedMetricSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>prefix</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>compensated-</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>stepId</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>21</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The sequence <code>test</code> is removed from the <code>initialSequences</code> set and sequence <code>__delay-session-start</code> takes place instead. This contains single step <code>delaySessionStart</code> that waits until its due and then schedules the sequence <code>test</code>. The compensated time is recorded by another handler that reuses the metric selector from the request but adds <code>compensated-</code> prefix.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-73b10aadce864c10f1d9f5a7f61eddee>Fetch embedded resources</h1><div class=lead>Simulate realistic website browsing with Hyperfoil&rsquo;s support for automated downloading and managing of embedded resources like images, stylesheets, and scripts</div><div class="td-byline mb-4"><time datetime=2020-11-16 class=text-body-secondary>Monday, November 16, 2020</time></div><p>When browsing a website it&rsquo;s not only the main page the webserver needs to serve - usually there are static resources such as images, stylesheets, scripts and more. Hyperfoil can automatically download these.</p><p>Hyperfoil implements a non-allocating HTML parser, with a pre-baked <code>onEmbeddedResource</code> handler: This selects HTML tags with appropriate attributes that represent an URL:</p><ul><li>Images: <code>&lt;img src="..."></code></li><li>Stylesheets: <code>&lt;link href="..."></code></li><li>Scripts: <code>&lt;script src="..."></code></li><li>Embedded media: <code>&lt;embed src="..."></code>, <code>&lt;object data="..."></code></li><li>Frames: <code>&lt;frame src="..."></code>, <code>&lt;iframe src="..."></code></li></ul><p>The other part of the solution is executing a <code>GET</code> request at given URL. Modern browsers don&rsquo;t download the resources one-by-one, nor do they fetch them all at once - usually these download around 6-8 resources in parallel. In Hyperfoil this is implemented by adding the URL to a queue. The queue delivers each URL to a new instance of a sequence (automatically generated) that fires the HTTP request, and limits the number of these sequences.</p><p>Since Hyperfoil pre-allocates all data structures ahead, you need to declare a limit on number of resources that can be fetched. If the queue cannot store more than <code>maxResources</code> URLs it simply discards the other URLs, emitting a warning to the log.</p><p>The parser signals the queue when there&rsquo;s no more data on the producing side, and when all of them are consumed the queue can fire some extra action. Note that completion of the original request does not wait until all the resources are fetched.</p><p>Below is an example of a configuration fetching embedded resources:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>fetching</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/foobar/index.html</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>handler</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>body</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>parseHtml</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>onEmbeddedResource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>fetchResource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>maxResources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>metric</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># Drop the query part</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#000>([^?]*)(\?.*)? -&gt; $1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>onCompletion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>set</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>allFetched &lt;- true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>For details please <a href=/docs/reference/steps/processor_parseHtml>see the reference</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-bf45a523571dd9adee5767986c0dc3e8>Automatic follow of redirects</h1><div class=lead>Simulate realistic user navigation with Hyperfoil&rsquo;s support for HTTP and HTML redirects</div><div class="td-byline mb-4"><time datetime=2020-11-16 class=text-body-secondary>Monday, November 16, 2020</time></div><p>Hyperfoil is trying to imitate how users will hit your site with requests as realistically as possible. Therefore it supports one of the browser features: redirections.</p><p>There are two ways how webservers tell browsers where to fetch another page: HTTP-level redirects where the server returns status 3xx and the new URL in the <code>Location</code> header, and HTML with <code>&lt;meta http-equiv="refresh" content="5; url=http://example.com" /></code>. The webpage can also use Javascript to switch to another page but Hyperfoil is not interpretting any Javascript.</p><p>You could implement the location-based redirect in YAML straight away:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>redirectMe</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>unset</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>location</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/redirectMe</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>metric</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>first_request</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>handler</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>header</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>filter</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>header</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>location</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>processor</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>store</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>location</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>fromVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>location</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>metric</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>second_request</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>This would work in simple cases but it comes with several down-sides:</p><ul><li>You assume that the <code>/redirectMe</code> always responds with redirecting status. If the server can respond with other status you need to check its value and fence any handlers with sentinel based on status+location presence.</li><li>Even with extra conditions the presented approach would not work if there is a series of redirections.</li><li>If you want to apply the same data (headers, body&mldr;) or handlers to both requests, you&rsquo;d need to copy-paste them.</li><li>If you&rsquo;re issuing a <code>POST</code> instead of <code>GET</code> request some status values require that the second request is a <code>GET</code>.</li><li>If the redirection URL is a relative one you&rsquo;d need to compose the final URL yourselves.</li><li>If there&rsquo;s a chance that the sequence is insantiated multiple times concurrently you&rsquo;d need to transform <code>location</code> to a sequence-scoped variable.</li></ul><p>Coding a general solution in YAML would be cumbersome, but you don&rsquo;t need to do that - all you need is:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>redirectMe</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/redirectMe</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>handler</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>followRedirect</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ALWAYS</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Underhood this simple option adds/rewraps all the handlers (not presented in the example) as needed. If the response has a non-3xx status and there&rsquo;s no refresh <code>&lt;meta /></code> tag everything is applied as usual. When the response suggests a redirect the request is executed in a new sequence. The request uses the same headers and body as the original request (evaluating the handlers second time, though) and all the original handlers are applied to the response. That includes handlers inserted through other &lsquo;magic&rsquo; options, e.g. the <code>sync</code> option: if the original request was marked as synchronous the original sequence won&rsquo;t continue until the series of redirections ends with a non-redirecting request.</p><p>You might also want to react only to HTTP-level redirections (use <code>followRedirect: LOCATION_ONLY</code>) or the <code>&lt;meta /></code> tag (use <code>followRedirect: HTML_ONLY</code>); the subsequent requests in the redirect chain will keep the same policy. The default value for the redirect is <code>NEVER</code> - both because of the principle of least surprise, to reduce memory footprint of the session and not complicate the debugging when redirects are not needed. If you prefer to keep the same policy for all requests in the benchmark you can change the default in the <a href=/docs/user-guide/benchmark/ergonomics/>ergonomics section</a>.</p><p>Note that while location-based redirect suppresses execution of all status-, headers- and body-handlers the HTML-redirect option (HTML redirect) runs all of them as usual even on the body part that does the redirect. Also, HTML-redirect supports the refresh timeout (load the page after X seconds) - this case warrants another generated sequence where the request is waiting to be executed.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-fbc771f2981eed29c0bc016b2d68a41a>2 - Releases</h1><div class=lead>Check out latest release updates</div></div><div class=td-content><h1 id=pg-7f5e49d79dd8d5f370882d2664b6586e>2.1 - Release Notes</h1><div class=lead>Summary of the main features and/or fixes by release</div><h2 id=026-2024-05-31>0.26 (2024-05-31)<a class=td-heading-self-link href=#026-2024-05-31 aria-label="Heading self-link"></a></h2><ul><li>Remove java.net.preferIPv4Stack=true</li><li>Disable automatic report opening with &ndash;silent option</li><li>Throw exception for misconfigured multi-host HTTP benchmark</li><li>Add agent property to configure the ssh key used</li><li>Set CPU Request in Benchmark</li><li>s390x: Define utf-8 encoding in compiler plugin</li><li>Dependecies upgrades, e.g., infinispan and vertx</li></ul><h2 id=0252-2023-08-03>0.25.2 (2023-08-03)<a class=td-heading-self-link href=#0252-2023-08-03 aria-label="Heading self-link"></a></h2><ul><li>Bug fix: Version command not working</li></ul><h2 id=0251-2023-08-02>0.25.1 (2023-08-02)<a class=td-heading-self-link href=#0251-2023-08-02 aria-label="Heading self-link"></a></h2><ul><li>Update dependencies</li></ul><h2 id=025-2023-06-28>0.25 (2023-06-28)<a class=td-heading-self-link href=#025-2023-06-28 aria-label="Heading self-link"></a></h2><ul><li>startWith: Delay feature</li><li>Enhancements</li><li>Bug fixes</li></ul><h2 id=0242-2023-05-02>0.24.2 (2023-05-02)<a class=td-heading-self-link href=#0242-2023-05-02 aria-label="Heading self-link"></a></h2><ul><li>Bug fix and enhancements</li></ul><h2 id=0241-2023-02-02>0.24.1 (2023-02-02)<a class=td-heading-self-link href=#0241-2023-02-02 aria-label="Heading self-link"></a></h2><ul><li>Return correct protocol</li><li>Validate wrk benchmark before running simulation</li></ul><h2 id=024-2022-12-15>0.24 (2022-12-15)<a class=td-heading-self-link href=#024-2022-12-15 aria-label="Heading self-link"></a></h2><ul><li>Initial support for Mac OS/x86_64</li><li>Fix serialization for Timestamp</li><li>Dependency updates</li></ul><h2 id=023-2022-10-31>0.23 (2022-10-31)<a class=td-heading-self-link href=#023-2022-10-31 aria-label="Heading self-link"></a></h2><ul><li>Fix for HTTP2 requests not flushing request body</li><li>Reimplemented randomCsvRow CSV parsing and quotes handling</li><li>Command <code>upload</code> in CLI/WebCLI now accepts URL</li></ul><h2 id=022-2022-09-19>0.22 (2022-09-19)<a class=td-heading-self-link href=#022-2022-09-19 aria-label="Heading self-link"></a></h2><ul><li>Fixes and output synchronization in <code>wrk</code>/<code>wrk2</code> commands</li><li>Fixes for aarch-64</li><li>Formatting in <code>timestamp</code> step</li><li>When a template is missing referenced file CLI asks user to provide it</li><li>One-key switch for interactive statistics in CLI</li></ul><h2 id=021-2022-07-12>0.21 (2022-07-12)<a class=td-heading-self-link href=#021-2022-07-12 aria-label="Heading self-link"></a></h2><ul><li>Minor bugfix-only release.</li></ul><h2 id=020-2022-05-26>0.20 (2022-05-26)<a class=td-heading-self-link href=#020-2022-05-26 aria-label="Heading self-link"></a></h2><ul><li>Vert.x 4.3 and Infinispan 13 for clustering</li><li>Bugfixes in templating and documentation</li></ul><h2 id=019-2022-02-22>0.19 (2022-02-22)<a class=td-heading-self-link href=#019-2022-02-22 aria-label="Heading self-link"></a></h2><ul><li>Minor release with bugfixes</li><li>Generic HTML tag parser: <a href=/docs/reference/steps/processor_parseHtml#ontagattribute>parseHtml.onTagAttribute</a></li></ul><h2 id=018-2021-12-16>0.18 (2021-12-16)<a class=td-heading-self-link href=#018-2021-12-16 aria-label="Heading self-link"></a></h2><ul><li>New benchmark templating system: <code>!param</code>, <code>!concat</code> and <code>!foreach</code></li><li>Mechanisms for storing global, agent-wide and thread-wide data</li><li>Improved error reporting and logging</li><li>HTTP endpoints can be referred to using a name rather than authority (host:port combination)</li><li>Custom SLAs: Tests that have external statistics can place SLAs on these.</li><li>Closed-model phases can be configured with <code>.usersPerAgent</code> and <code>.usersPerThread</code></li><li>New actions for manipulating collections</li><li>New step and action for restarting current sequence</li><li>New action for marking request as invalid manually</li><li>Other utility processors and added properties on existings steps/actions</li><li>Fix various issues with statistics from auxiliary verticles.</li></ul><h2 id=017-2021-10-21>0.17 (2021-10-21)<a class=td-heading-self-link href=#017-2021-10-21 aria-label="Heading self-link"></a></h2><ul><li>More options for configuration of agent pods (resources, labels&mldr;) - courtesy of Stephen Connolly</li><li>Upgrade of Apache MINA</li></ul><h2 id=016-2021-06-11>0.16 (2021-06-11)<a class=td-heading-self-link href=#016-2021-06-11 aria-label="Heading self-link"></a></h2><ul><li>This release removes some code-bloat for extension developers, using reflection to scan the scenario:<ul><li>Session variables do not need to be explicitly reserved in <code>ResourceUtilizer.reserve()</code> method.</li><li>Components owning another components do not have to propagate the resource resevation calls.</li></ul></li><li>Automatic check for reading from a variable that&rsquo;s never written to.</li><li>Controller can loads statistics from old runs (therefore CLI can show stats from runs before reboot)<ul><li>Statistics from old runs are unloaded in order to prevent running out-of-memory in constrained environments.</li></ul></li><li>Phases can now be marked with <code>isWarmup: true</code> - reporting can hide data from these phases by default</li><li>Agents deployed via SSH can set list of cpus on which to run (using taskset).</li><li>Self-checks for excessive CPU usage on agents, record CPU usage in each phase.</li><li>Various fixes and improvements in WebCLI.</li></ul><h2 id=015-2021-04-09>0.15 (2021-04-09)<a class=td-heading-self-link href=#015-2021-04-09 aria-label="Heading self-link"></a></h2><ul><li>Introduced statistics for connections (#connections by type, active connections and in-flight requests&mldr;)</li><li>New connection strategies: Open connections for each session/request<ul><li><code>ergonomics.privatePools</code> replaced by <code>http.connectionStrategy</code></li></ul></li><li><code>http.sharedConnections</code> can be set using sub-properties <code>core</code>, <code>max</code>, <code>buffer</code> and <code>keepAliveTime</code>.</li><li>Dropped <code>RequestProcessorBuilder</code> and <code>HttpRequestProcessorBuilder</code> in favor of <code>Processor.Builder</code><ul><li>If the processor is used in an incompatible context it should cause a runtime error</li></ul></li><li>POC support for Hot Rod protocol connecting to Infinispan clusters.</li><li>k8s deployer: agent labels and tolerations</li><li>Many improvements to WebCLI, notably automatic reconnect and <code>plot</code> command</li><li>Statistics rework: HTTP-related statistics are separated into extensions, some fields were dropped or renamed<ul><li>Report schema changed to v3.0 to reflect this (+piggybacked agent address/name changes)</li></ul></li><li>Upgrade to Vert.x 4.0</li></ul><h2 id=014-2021-02-22>0.14 (2021-02-22)<a class=td-heading-self-link href=#014-2021-02-22 aria-label="Heading self-link"></a></h2><ul><li>Significant refactoring of HTTP-related code into its own module<ul><li>Programmatic configuration requires some changes but there were no changes for YAML definitions</li></ul></li><li>Hyperfoil Controller now serves WebCLI at root path<ul><li>OpenAPI definition moved to <code>/openapi</code></li></ul></li></ul><h2 id=013-2021-01-28>0.13 (2021-01-28)<a class=td-heading-self-link href=#013-2021-01-28 aria-label="Heading self-link"></a></h2><p>This is mostly a bugfix release with minor convenience improvements.</p><ul><li>Run CLI in container simply using <code>docker/podman run -it --rm --network=host quay.io/hyperfoil/hyperfoil cli</code></li></ul><h2 id=012-2020-12-16>0.12 (2020-12-16)<a class=td-heading-self-link href=#012-2020-12-16 aria-label="Heading self-link"></a></h2><ul><li>Hyperfoil now requires JDK 11</li><li>BREAKING CHANGE: extra files are now loaded relative to benchmark YAML file, not working directory</li><li>CLI improvements:<ul><li>Upload benchmarks in text-mode (lower chance of serialization issues)</li><li>Ask for re-upload of extra files</li><li><code>inspect</code> command to reveal detailed structure of the benchmark</li></ul></li><li>Status 4xx and 5xx is not counted as error for purposes of <code>SLA.errorRatio</code> (use <code>SLA.invalidRatio</code>)</li><li>Hyperfoil controller can be exposed using HTTPS and offers Basic authentication scheme.</li><li>Mode with coordinated-omission compensation: see <a href=/docs/reference/steps/step_httpRequest#compensation>httpRequest.compensation</a>.</li><li>Support for GZIP compression of responses: see <a href=/docs/reference/steps/step_httpRequest#compression>httpRequest.compression</a>.</li><li>New generator step: <code>randomFile</code></li><li>Image build now can be done using <code>podman</code></li></ul><h2 id=011-2020-11-18>0.11 (2020-11-18)<a class=td-heading-self-link href=#011-2020-11-18 aria-label="Heading self-link"></a></h2><ul><li>Fix a critical memory leak in the use of Netty&rsquo;s direct buffers.</li><li>Fix problems in HTML redirect.</li></ul><h2 id=010-2020-11-13>0.10 (2020-11-13)<a class=td-heading-self-link href=#010-2020-11-13 aria-label="Heading self-link"></a></h2><ul><li>Explicit concurrency limits on sequences, e.g <code>mySequence[6]</code>.<ul><li><code>maxSequences</code> on scenario is not used anymore.</li></ul></li><li>Concurrent sequences have its own copy of each resource by default.</li><li>Reworked <code>loop</code> step.</li><li>Renamed <code>simple</code> recorder (processor) to <code>store</code>.</li><li>Step <code>httpRequest</code> now implements <code>handler.followRedirect</code>, automatically sending another request(s) upon 3xx status or &lt;meta http-equiv=&ldquo;refresh&rdquo; &mldr;> in HTML.</li><li>HTTP 1.1 is now implemented without relying on Netty&rsquo;s parser - saving allocations (HTTP 2.0 is still TODO).</li><li>Reworked ways to modify other parts of the benchmark from withing the builder (Locator).</li><li>Reduced need for boilerplate code in builders.</li><li>Many bugfixes and small improvements.</li></ul><h2 id=09-2020-05-28>0.9 (2020-05-28)<a class=td-heading-self-link href=#09-2020-05-28 aria-label="Heading self-link"></a></h2><p>This is a bugfix-release.</p><h2 id=08-2020-04-24>0.8 (2020-04-24)<a class=td-heading-self-link href=#08-2020-04-24 aria-label="Heading self-link"></a></h2><ul><li>Renamed phase types:<ul><li><code>constantPerSec</code> → <code>constantRate</code></li><li><code>rampPerSec</code> → <code>increasingRate</code>/<code>decreasingRate</code></li></ul></li><li>Change meaning of <code>SLA.blockedRatio</code>: the value should be between 0 and 1 (inclusively) where 1 allows blocking without limits.</li><li>New SLA check <code>invalidRatio</code>.</li><li>4xx and 5xx responses mark the request as invalid by default (configurable through <code>ergonomics.autoRangeCheck</code>).</li><li>When a response is marked as invalid session execution stops immediately (configurable through <code>ergonomics.stopOnInvalid</code>).</li><li>Implemented replace and delete operation in the <code>json</code> step and processor.</li><li><code>responseSizeRecorder</code> replaced with <code>transferSizeRecorder</code>, calculating uploaded bytes as well.</li><li>Agents now host a <code>default</code> section where you can define common configuration.</li><li>Each agent can have different number of threads, using the <code>threads</code> property.</li><li>Report schema changed, now using schema <code>http://hyperfoil.io/run-schema/v2.0</code></li></ul><h2 id=071-2020-02-26>0.7.1 (2020-02-26)<a class=td-heading-self-link href=#071-2020-02-26 aria-label="Heading self-link"></a></h2><p>Bugfix-only release.</p><ul><li>Fixed threading model when using <code>wrk</code> command</li><li>Fixed HTTP parsing for <code>rawBytesHandlers</code></li><li>Fixed <code>stop</code> used either as step or in a handler</li></ul><p>Please see <code>git log</code> for info about older releases.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub Discussions" aria-label="GitHub Discussions"><a target=_blank rel=noopener href=https://github.com/Hyperfoil/Hyperofil/discussions aria-label="GitHub Discussions"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Twitter aria-label=Twitter><a target=_blank rel=noopener href=https://x.com/Hyperfoil aria-label=Twitter><i class="fab fa-twitter"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/Hyperfoil/Hyperofil aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Zulip aria-label=Zulip><a target=_blank rel=noopener href=https://hyperfoil.zulipchat.com/ aria-label=Zulip><i class="fab fa-z"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub Issues" aria-label="GitHub Issues"><a target=_blank rel=noopener href=https://github.com/Hyperfoil/Hyperofil/issues aria-label="GitHub Issues"><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2017&ndash;2024
<span class=td-footer__authors>Hyperfoil | <a href=https://www.apache.org/licenses/LICENSE-2.0>Apache License 2.0</a> |</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/hyperfoil-website-demo/js/main.min.53f3e04e8d693751b0d08317a1dfec9508d2a99f2a3d232d929e075cd6f20865.js integrity="sha256-U/PgTo1pN1Gw0IMXod/slQjSqZ8qPSMtkp4HXNbyCGU=" crossorigin=anonymous></script>
<script defer src=/hyperfoil-website-demo/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script>
<script src=/hyperfoil-website-demo/js/tabpane-persist.js></script></body></html>