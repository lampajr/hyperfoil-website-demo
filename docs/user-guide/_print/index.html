<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://lampajr.github.io/hyperfoil-website-demo/docs/user-guide/><link rel=alternate type=application/rss+xml href=https://lampajr.github.io/hyperfoil-website-demo/docs/user-guide/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/hyperfoil-website-demo/favicons/favicon.ico><link rel=apple-touch-icon href=/hyperfoil-website-demo/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/hyperfoil-website-demo/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/hyperfoil-website-demo/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/hyperfoil-website-demo/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/hyperfoil-website-demo/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/hyperfoil-website-demo/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/hyperfoil-website-demo/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/hyperfoil-website-demo/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/hyperfoil-website-demo/favicons/android-192x192.png sizes=192x192><title>User Guide | Hyperfoil</title><meta name=description content="Comprehensive set of resourcs for everything you need to get started with Hyperfoil"><meta property="og:title" content="User Guide"><meta property="og:description" content="Comprehensive set of resourcs for everything you need to get started with Hyperfoil"><meta property="og:type" content="website"><meta property="og:url" content="https://lampajr.github.io/hyperfoil-website-demo/docs/user-guide/"><meta itemprop=name content="User Guide"><meta itemprop=description content="Comprehensive set of resourcs for everything you need to get started with Hyperfoil"><meta name=twitter:card content="summary"><meta name=twitter:title content="User Guide"><meta name=twitter:description content="Comprehensive set of resourcs for everything you need to get started with Hyperfoil"><link rel=preload href=/hyperfoil-website-demo/scss/main.min.d0336840d8c0ef45658fa040135fe63f4426d79b707feb7cf795756dd7001fc7.css as=style><link href=/hyperfoil-website-demo/scss/main.min.d0336840d8c0ef45658fa040135fe63f4426d79b707feb7cf795756dd7001fc7.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/hyperfoil-website-demo/><span class="navbar-brand__logo navbar-logo"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="200pt" height="200pt" viewBox="0 0 200 200"><g transform="translate(0.000000,200.000000) scale(0.100000,-0.100000)" fill="#000" stroke="none"><path d="M692 1873c-28-5-45-42-109-231-82-246-95-317-1e2-572-4-171-1-254 11-345 25-186 20-177 107-198 103-26 359-28 480-4 167 33 349 105 349 138 0 63-115 359-332 854-80 182-148 338-151 348-6 15-20 17-119 16-62-1-123-4-136-6zm228-1e2c0-106 20-593 26-640 5-43 6-43 46-43h40l-6 48c-8 69-29 512-24 517 4 4 289-634 338-760 33-83 80-222 80-235 0-19-298-120-354-120-13 0-16 13-16 68 0 37-3 97-7 135l-6 67h-38c-26 0-37-4-34-12 2-7 6-70 10-140l6-127-47-7c-49-7-250 10-320 27l-41 11-12 68c-38 230-38 515-1 705 21 107 97 352 138 447 23 52 27 53 155 56l67 2v-67z"/><path d="M1460 580c-31-4-103-24-160-44-219-78-416-102-609-72-57 9-106 14-108 13-10-11 294-67 363-67 31 0 32-1 38-57 4-32 10-66 12-76 5-14-17-28-113-74l-118-57 48-15 49-15 196 99c169 84 193 99 172 106-40 12-79 10-108-5-15-7-37-17-50-21-22-6-23-5-20 52l3 58 120 2c66 2 147 5 181 8l61 6 52 81c28 44 51 81 49 82s-28-1-58-4z"/></g></svg></span><span class=navbar-brand__name>Hyperfoil</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=/hyperfoil-website-demo/docs/><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/hyperfoil-website-demo/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/hyperfoil-website-demo/download/><span>Download</span></a></li><li class=nav-item><a class=nav-link href=/hyperfoil-website-demo/community/><span>Community</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/hyperfoil-website-demo/offline-search-index.4fedb1b10adbca20f172412690f08cb1.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/hyperfoil-website-demo/docs/user-guide/>Return to the regular view of this page</a>.</p></div><h1 class=title>User Guide</h1><div class=lead>Comprehensive set of resourcs for everything you need to get started with Hyperfoil</div><ul><li>1: <a href=#pg-3d4feb145da9af18dcaedf5b8372894a>Installation</a></li><ul><li>1.1: <a href=#pg-ff809110397f9741adad09d719b356f2>Manual startup</a></li><li>1.2: <a href=#pg-f9f986e3fb547c118cd69904afdfdd3f>K8s/Openshift deployment</a></li><li>1.3: <a href=#pg-bf4589d8e0fac53dabd39bc5f2e0a20e>Manual k8s/Openshift deployment</a></li><li>1.4: <a href=#pg-a732327a38e5b0b5deb4162f4a7f7229>Ansible startup</a></li></ul><li>2: <a href=#pg-1aa0b1f37dce687249000b3550a88754>Benchmark</a></li><ul><li>2.1: <a href=#pg-58d6d997673b74a5517024f9baf5d16e>Agents</a></li><li>2.2: <a href=#pg-b1acdfa3d39eb15b26e75568d16f4ab3>HTTP</a></li><li>2.3: <a href=#pg-64114ea0efc225d733997a7c881c7cfd>Phases</a></li><li>2.4: <a href=#pg-02d9ad0faa5977a6fc32c799a9f1fe2b>Scenario</a></li><li>2.5: <a href=#pg-4857c7f234ff4c339e1e27e0d7c72157>Variables</a></li><li>2.6: <a href=#pg-ed2898c43a28d1cdf654b47cf571de58>Templates</a></li><li>2.7: <a href=#pg-eac813dee30aae69c7dc037191fce294>Hooks</a></li><li>2.8: <a href=#pg-9324f9d2479e31fa80f07d85df3cc6df>Ergonomics</a></li></ul><li>3: <a href=#pg-7db80c30652628d25611531a8cdce078>Examples</a></li><li>4: <a href=#pg-b2c7826362a5f4e84154bb1e2badfada>Troubleshooting</a></li></ul><div class=content><p>Welcome to the Hyperfoil User Guide, your comprehensive resource for everything you need to get started. This section covers installation, detailed instructions on defining benchmarks, and troubleshooting tips to help you resolve common issues. Whether you&rsquo;re a beginner or an advanced user, you&rsquo;ll find valuable information to enhance your performance testing with Hyperfoil.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-3d4feb145da9af18dcaedf5b8372894a>1 - Installation</h1><div class=lead>Detailed instructions for installing Hyperfoil manually, on Kubernetes/Openshift, or with Ansible.</div><p>In this section, you’ll find detailed instructions for installing and setting up Hyperfoil using various methods, including manual setup, Ansible, and Kubernetes/Openshift. Follow these guides to choose the best installation procedure for your environment.</p></div><div class=td-content><h1 id=pg-ff809110397f9741adad09d719b356f2>1.1 - Manual startup</h1><div class=lead>Explore manual startup options for the Hyperfoil controller.</div><p>Hyperfoil controller is started with</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>bin/controller.sh
</span></span></code></pre></div><p>Any arguments passed to the scripts will be passed as-is to the <code>java</code> process.</p><p>By default <code>io.hyperfoil.deployer</code> is set to <code>ssh</code> which means that the controller will deploy agents over SSH, based on the <a href=/docs/user-guide/benchmark/agent/#ssh-deployer>agents configurion</a>. This requires that the user account running the controller must have public-key SSH authorization set up using key <code>$HOME/.ssh/id_rsa</code>. The user also has to be able to copy files to the directory set in agent definition (by default <code>/tmp/hyperfoil</code>) using SCP - Hyperfoil automatically synchronizes library files in this folder with the currently running instance and then executes the agent.</p><p>When you don&rsquo;t intend to run distributed benchmarks you can start the controller in <em>standalone</em> mode:</p><pre tabindex=0><code>bin/standalone.sh
</code></pre><p>This variant won&rsquo;t deploy any agents remotely and therefore it does not need any <code>agents:</code> section in the <a href=/docs/user-guide/benchmark>benchmark definition</a>; instead it will use single agent started in the same JVM.</p><p>Below is the comprehensive list of all the properties Hyperfoil recognizes. All system properties can be replaced by environment variables, uppercasing the letters and replacing dots and dashes with underscores: e.g. <code>io.hyperfoil.controller.host</code> becomes <code>IO_HYPERFOIL_CONTROLLER_HOST</code>.</p><table><thead><tr><th>Property</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>io.hyperfoil.controller.host</td><td>0.0.0.0</td><td>Host for Controller REST server</td></tr><tr><td>io.hyperfoil.controller.port</td><td>8090</td><td>Port for Controller REST server</td></tr><tr><td>io.hyperfoil.rootdir</td><td>/tmp/hyperfoil</td><td>Root directory for stored files</td></tr><tr><td>io.hyperfoil.benchmarkdir</td><td><em>root</em>/benchmark</td><td>Benchmark files (YAML and serialized)</td></tr><tr><td>io.hyperfoil.rundir</td><td><em>root</em>/run</td><td>Run result files (configs, stats&mldr;)</td></tr><tr><td>io.hyperfoil.deployer</td><td>ssh</td><td>Implementation for agents deployment</td></tr><tr><td>io.hyperfoil.deployer.timeout</td><td>15000 ms</td><td>Timeout for agents to start</td></tr><tr><td>io.hyperfoil.agent.debug.port</td><td></td><td>If set, agent will be started with JVM debug port open</td></tr><tr><td>io.hyperfoil.agent.debug.suspend</td><td>n</td><td>Suspend parameter for the debug port</td></tr><tr><td>io.hyperfoil.controller.cluster.ip</td><td>first non-loopback</td><td>Hostname/IP used for clustering with agents</td></tr><tr><td>io.hyperfoil.controller.cluster.port</td><td>7800</td><td>Default JGroups clustering port</td></tr><tr><td>io.hyperfoil.controller.external.uri</td><td></td><td>Externally advertised URI of REST server</td></tr><tr><td>io.hyperfoil.controller.keystore.path</td><td></td><td>File path to Java Keystore</td></tr><tr><td>io.hyperfoil.controller.keystore.password</td><td></td><td>Java Keystore password</td></tr><tr><td>io.hyperfoil.controller.pem.keys</td><td></td><td>File path(s) to private TLS key(s) in PEM format</td></tr><tr><td>io.hyperfoil.controller.pem.certs</td><td></td><td>File path(s) to server TLS certificate(s) in PEM format</td></tr><tr><td>io.hyperfoil.controller.password</td><td></td><td>Password used for Basic authentication</td></tr><tr><td>io.hyperfoil.controller.secured.via.proxy</td><td></td><td>This must be set to <code>true</code> for Basic auth without TLS encryption</td></tr><tr><td>io.hyperfoil.trigger.url</td><td></td><td>See below</td></tr></tbody></table><p>If <code>io.hyperfoi.trigger.url</code> is set the controller does not start benchmark run right away after hitting <code>/benchmark/my-benchmark/start</code> ; instead it responds with status 301 and header Location set to concatenation of this string and <code>BENCHMARK=my-benchmark&amp;RUN_ID=xxxx</code>. CLI interprets that response as a request to hit CI instance on this URL, assuming that CI will trigger a new job that will eventually call <code>/benchmark/my-benchmark/start?runId=xxxx</code> with header <code>x-trigger-job</code>. This is useful if the the CI has to synchronize Hyperfoil to other benchmarks that don&rsquo;t use this controller instance.</p><h2 id=security>Security<a class=td-heading-self-link href=#security aria-label="Heading self-link"></a></h2><p>Since Hyperfoil accepts and invoked any serialized Java objects you must not run it exposed to public to prevent a very simple remote code execution. Even if using HTTPS and password protection (see below) we recommend to limit access and privileges of the process to absolute minimum.</p><p>You can get confidential access to the server using TLS encryption, providing the certificate and keys either using Java Keystore mechanism (properties above starting with <code>io.hyperfoil.controller.keystore</code>) or via PEM files (properties starting with <code>io.hyperfoil.controller.pem</code>). These options are mutually exclusive. In the latter case it is possible to use multiple certificate/key files, separated by comma (,).</p><p>Authentication uses Basic authentication scheme accepting any string as username. The password is set using <code>io.hyperfoil.controller.password</code> or respective environment variable. If you&rsquo;re exposing the server using plaintext HTTP you must set <code>-Dio.hyperfoil.controller.secured.via.proxy=true</code> to confirm that this is a desired configuration (e.g. if the TLS is terminated at proxy and the connection from proxy does not require confidentiality).</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f9f986e3fb547c118cd69904afdfdd3f>1.2 - K8s/Openshift deployment</h1><div class=lead>Deploy Hyperfoil in Kubernetes or Openshift environment using the out-of-the-box Hyperfoil operator</div><p>A convenient alternative to running Hyperfoil on hosts with SSH access is deploying it in Kubernetes or Openshift environment. The recommended way to install it using an operator in your Openshift console - just go to Operators - OperatorHub and search for &lsquo;hyperfoil&rsquo;, and follow the installation wizard. Alternatively you can <a href=/docs/user-guide/installation/k8s_manual/>deploy the controller manually</a>.</p><p>In order to start a Hyperfoil Controller instance in your cluster, create a new namespace <code>hyperfoil</code>: Go to Operators - Installed Operators and open Hyperfoil. In upper left corner select &lsquo;Project: &rsquo; - Create project and fill out the details. Then click on the &lsquo;Hyperfoil&rsquo; tab and find the button &lsquo;Create Hyperfoil&rsquo;.</p><p>You should see a YAML definition like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hyperfoil.io/v1alpha2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Hyperfoil</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-hyperfoil</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hyperfoil</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>agentDeployTimeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>60000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>log</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>myConfigMap/log4j2-superverbose.xml</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>route</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hyperfoil.apps.mycloud.example.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Change the <code>name</code> to just <code>hyperfoil</code> (or whatever you prefer) and delete all the content from the <code>spec</code> section:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hyperfoil.io/v1alpha2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Hyperfoil</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hyperfoil</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hyperfoil</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>This is a perfectly valid Hyperfoil resource with everything set to default values. You can customize some properties in the <code>spec</code> section further - see the <a href=#reference>reference</a>.</p><p>The operator deploys only the controller; each agent is then started when the run starts as a <code>pod</code> in the same namespace and stopped when the run completes.</p><p>When the resource becomes ready (you can check it out through Openshift CLI using <code>oc get hf</code>) the controller pod should be up and running. Now you can open Hyperfoil CLI and connect to the controller. While default Hyperfoil port is 8090, default route setting uses TLS (edge) and therefore Openshift router will expose the service on port 443. If your cluster&rsquo;s certificate is not recognized (such as when using self-signed certificates) you need to use <code>--insecure</code> (or <code>-k</code>) option.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>bin/cli.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>hyperfoil<span style=color:#ce5c00;font-weight:700>]</span>$ connect hyperfoil-hyperfoil.apps.my.cluster.domain:443 --insecure
</span></span><span style=display:flex><span>WARNING: Hyperfoil TLS certificate validity is not checked. Your credentials might get compromised.
</span></span><span style=display:flex><span>Connected!
</span></span><span style=display:flex><span>WARNING: Server <span style=color:#204a87>time</span> seems to be off by <span style=color:#0000cf;font-weight:700>12124</span> ms
</span></span></code></pre></div><p>Now you can upload & run benchmarks as usual - we&rsquo;re using {% include example_link.md src=&lsquo;k8s-hello-world.hf.yaml&rsquo; %} in this example. Note that it can take several seconds to spin up containers with agents.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>hyperfoil@hyperfoil-hyperfoil<span style=color:#ce5c00;font-weight:700>]</span>$ upload examples/k8s-hello-world.hf.yaml
</span></span><span style=display:flex><span>Loaded benchmark k8s-hello-world, uploading...
</span></span><span style=display:flex><span>... <span style=color:#204a87;font-weight:700>done</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>hyperfoil@hyperfoil-hyperfoil<span style=color:#ce5c00;font-weight:700>]</span>$ run k8s-hello-world
</span></span><span style=display:flex><span>Started run <span style=color:#0000cf;font-weight:700>0000</span>
</span></span><span style=display:flex><span>Run 0000, benchmark k8s-hello-world
</span></span><span style=display:flex><span>Agents: agent-one<span style=color:#ce5c00;font-weight:700>[</span>STARTING<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>Started: 2019/11/18 19:07:36.752    Terminated: 2019/11/18 19:07:41.778
</span></span><span style=display:flex><span>NAME  STATUS      STARTED       REMAINING  COMPLETED     TOTAL DURATION               DESCRIPTION
</span></span><span style=display:flex><span>main  TERMINATED  19:07:36.753             19:07:41.778  <span style=color:#0000cf;font-weight:700>5025</span> ms <span style=color:#ce5c00;font-weight:700>(</span>exceeded by <span style=color:#0000cf;font-weight:700>25</span> ms<span style=color:#ce5c00;font-weight:700>)</span>  5.00 users per second
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>hyperfoil@hyperfoil-hyperfoil<span style=color:#ce5c00;font-weight:700>]</span>$
</span></span></code></pre></div><p>You can find more details about adjusting the agents in the <a href=/docs/user-guide/benchmark/agent/#kubernetesopenshift-deployer>benchmark format reference</a>.</p><p>Running Hyperfoil inside the cluster you are trying to test might skew results due to different network topology compared to driving the load from &lsquo;outside&rsquo; (as real users would do). It is your responsibility to validate if your setup and separation between load driver and SUT (system under test) is correct. You have been warned.</p><h2 id=reference>Reference<a class=td-heading-self-link href=#reference aria-label="Heading self-link"></a></h2><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>version</td><td>Tag for controller image (e.g. <code>0.14</code> for a released version or <code>0.15-SNAPSHOT</code> for last build from main (master) branch). Defaults to <code>latest</code>.</td></tr><tr><td>image</td><td>Controller image. If &lsquo;version&rsquo; is defined, too, the tag is replaced (or appended). Defaults to &lsquo;quay.io/hyperfoil/hyperfoil&rsquo;</td></tr><tr><td><a href=#route>route</a></td><td>Configuration for the route leading to Controller REST endpoint.</td></tr><tr><td><a href=#auth>auth</a></td><td>Authorization configuration.</td></tr><tr><td>log</td><td>Name of the config map and optionally its entry (separated by &lsquo;/&rsquo;: e.g myconfigmap/log4j2-superverbose.xml) storing Log4j2 configuration file. By default the Controller uses its embedded configuration.</td></tr><tr><td>agentDeployTimeout</td><td>Deploy timeout for agents, in milliseconds.</td></tr><tr><td>triggerUrl</td><td>Value for <code>io.hyperfoil.trigger.url</code> - <a href=#starting-the-controller-manually>see above</a></td></tr><tr><td>preHooks</td><td>List of config map names holding hooks that run before the run starts.</td></tr><tr><td>postHooks</td><td>List of config map names holding hooks that run when the run finishes.</td></tr><tr><td>persistentVolumeClaim</td><td>Name of the PVC Hyperfoil should mount for its workdir.</td></tr></tbody></table><h3 id=route>route<a class=td-heading-self-link href=#route aria-label="Heading self-link"></a></h3><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>host</td><td>Host for the route leading to Controller REST endpoint. Example: hyperfoil.apps.cloud.example.com</td></tr><tr><td>type</td><td>Either &lsquo;http&rsquo; (for plain-text routes - not recommended), &rsquo;edge&rsquo;, &lsquo;reencrypt&rsquo; or &lsquo;passthrough&rsquo;</td></tr><tr><td>tls</td><td>Name of the secret hosting <code>tls.crt</code>, <code>tls.key</code> and optionally <code>ca.crt</code>. This is mandatory for <code>passthrough</code> routes and optional for edge and reencrypt routes</td></tr></tbody></table><h3 id=auth>auth<a class=td-heading-self-link href=#auth aria-label="Heading self-link"></a></h3><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>secret</td><td>Name of secret used for basic authentication. Must contain key <code>password</code>; Hyperfoil accepts any username for login.</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-bf4589d8e0fac53dabd39bc5f2e0a20e>1.3 - Manual k8s/Openshift deployment</h1><div class=lead>Manually deploy Hyperfoil in Kubernetes or Openshift environment</div><p>If you cannot <a href=/docs/user-guide/installation/k8s/>use the operator</a> or if you&rsquo;re running vanilla Kubernetes you can define all the resource manually. You deploy only the controller; each agent is then started, when the run starts, as a <code>pod</code> in the same namespace and stopped when the run completes.</p><p>Following steps install Hyperfoil controller in Openshift, assuming that you have all the required priviledges. With vanilla Kubernetes you might have to replace the <code>route</code> with an appropriate <code>ingress</code>.</p><h4 id=1-create-new-namespace-for-hyperfoil>1. Create new namespace for hyperfoil<a class=td-heading-self-link href=#1-create-new-namespace-for-hyperfoil aria-label="Heading self-link"></a></h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>oc new-project hyperfoil
</span></span></code></pre></div><h4 id=2-create-required-resources>2. Create required resources<a class=td-heading-self-link href=#2-create-required-resources aria-label="Heading self-link"></a></h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl -s -L k8s.hyperfoil.io <span style=color:#000;font-weight:700>|</span> oc apply -f -
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>role.rbac.authorization.k8s.io/controller created
</span></span><span style=display:flex><span>serviceaccount/controller created
</span></span><span style=display:flex><span>service/hyperfoil created
</span></span><span style=display:flex><span>rolebinding.rbac.authorization.k8s.io/controller created
</span></span><span style=display:flex><span>deploymentconfig.apps.openshift.io/controller created
</span></span><span style=display:flex><span>route.route.openshift.io/hyperfoil created
</span></span></code></pre></div><p>The route will use hostname following the format <code>hyperfoil-hyperfoil.apps.my.cluster.domain</code> - feel free to customize the hostname as needed.</p><h4 id=3-wait-until-the-image-gets-downloaded-and-the-container-starts>3. Wait until the image gets downloaded and the container starts<a class=td-heading-self-link href=#3-wait-until-the-image-gets-downloaded-and-the-container-starts aria-label="Heading self-link"></a></h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>oc get po
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>NAME                  READY   STATUS              RESTARTS   AGE
</span></span><span style=display:flex><span>controller-1-pqbvs    1/1     Running             <span style=color:#0000cf;font-weight:700>0</span>          57s
</span></span><span style=display:flex><span>controller-1-deploy   0/1     Completed           <span style=color:#0000cf;font-weight:700>0</span>          72s
</span></span></code></pre></div><h4 id=4-open-cli-and-connect-to-the-controller>4. Open CLI and connect to the controller<a class=td-heading-self-link href=#4-open-cli-and-connect-to-the-controller aria-label="Heading self-link"></a></h4><p>While default Hyperfoil port is 8090, Openshift router will expose the service on port 80.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>bin/cli.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>hyperfoil<span style=color:#ce5c00;font-weight:700>]</span>$ connect hyperfoil-hyperfoil.apps.my.cluster.domain -p <span style=color:#0000cf;font-weight:700>80</span>
</span></span><span style=display:flex><span>Connected!
</span></span><span style=display:flex><span>WARNING: Server <span style=color:#204a87>time</span> seems to be off by <span style=color:#0000cf;font-weight:700>12124</span> ms
</span></span></code></pre></div><h4 id=5-upload-and-run-benchmarks-as-usual>5. Upload and run benchmarks as usual<a class=td-heading-self-link href=#5-upload-and-run-benchmarks-as-usual aria-label="Heading self-link"></a></h4><p>We&rsquo;re using <code>k8s-hello-world.hf.yaml</code> in this example.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>k8s-hello-world</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>agents</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>agent-one</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>https://kubernetes.default.svc.cluster.local</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>5s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Note that it can take several seconds to spin up containers with agents.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>hyperfoil@hyperfoil-hyperfoil<span style=color:#ce5c00;font-weight:700>]</span>$ upload .../k8s-hello-world.hf.yaml
</span></span><span style=display:flex><span>Loaded benchmark k8s-hello-world, uploading...
</span></span><span style=display:flex><span>... <span style=color:#204a87;font-weight:700>done</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>hyperfoil@hyperfoil-hyperfoil<span style=color:#ce5c00;font-weight:700>]</span>$ run k8s-hello-world
</span></span><span style=display:flex><span>Started run <span style=color:#0000cf;font-weight:700>0000</span>
</span></span><span style=display:flex><span>Run 0000, benchmark k8s-hello-world
</span></span><span style=display:flex><span>Agents: agent-one<span style=color:#ce5c00;font-weight:700>[</span>STARTING<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>Started: 2019/11/18 19:07:36.752    Terminated: 2019/11/18 19:07:41.778
</span></span><span style=display:flex><span>NAME  STATUS      STARTED       REMAINING  COMPLETED     TOTAL DURATION               DESCRIPTION
</span></span><span style=display:flex><span>main  TERMINATED  19:07:36.753             19:07:41.778  <span style=color:#0000cf;font-weight:700>5025</span> ms <span style=color:#ce5c00;font-weight:700>(</span>exceeded by <span style=color:#0000cf;font-weight:700>25</span> ms<span style=color:#ce5c00;font-weight:700>)</span>  5.00 users per second
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>hyperfoil@hyperfoil-hyperfoil<span style=color:#ce5c00;font-weight:700>]</span>$
</span></span></code></pre></div><p>You can find more details about adjusting the agents in the <a href=/docs/user-guide/benchmark/agent/#kubernetesopenshift-deployer>benchmark format reference</a>.</p><p>Running Hyperfoil inside the cluster you are trying to test might skew results due to different network topology compared to driving the load from &lsquo;outside&rsquo; (as real users would do). It is your responsibility to validate if your setup and separation between load driver and SUT (system under test) is correct. You have been warned.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-a732327a38e5b0b5deb4162f4a7f7229>1.4 - Ansible startup</h1><div class=lead>Deploy Hyperfoil using Ansible Galaxy scripts</div><p>You can fetch release, distribute and start the cluster using Ansible Galaxy scripts; <a href=https://github.com/Hyperfoil/hyperfoil_setup>setup</a>, <a href=https://github.com/Hyperfoil/hyperfoil_test>test</a>, <a href=https://github.com/Hyperfoil/hyperfoil_shutdown>shutdown</a></p><p>First, get the scripts:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ansible-galaxy install hyperfoil.hyperfoil_setup,<span style=color:#ce5c00;font-weight:700>{{</span> site.last_release.galaxy_version <span style=color:#ce5c00;font-weight:700>}}</span>
</span></span><span style=display:flex><span>ansible-galaxy install hyperfoil.hyperfoil_shutdown,<span style=color:#ce5c00;font-weight:700>{{</span> site.last_release.galaxy_version <span style=color:#ce5c00;font-weight:700>}}</span>
</span></span><span style=display:flex><span>ansible-galaxy install hyperfoil.hyperfoil_test,<span style=color:#ce5c00;font-weight:700>{{</span> site.last_release.galaxy_version <span style=color:#ce5c00;font-weight:700>}}</span>
</span></span></code></pre></div><p>Now, edit your <code>hosts</code> file, it could look like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>hyperfoil-controller<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>controller <span style=color:#000>ansible_host</span><span style=color:#ce5c00;font-weight:700>=</span>localhost
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>hyperfoil-agent<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>agent-1 <span style=color:#000>ansible_host</span><span style=color:#ce5c00;font-weight:700>=</span>localhost
</span></span></code></pre></div><div class="alert alert-primary" role=alert><h4 class=alert-heading>Note</h4>You can add more agents by duplicating the last line with <code>agent-2</code> etc.</div><p>Prepare your playbook; here is a short example that starts the controller, uploads and starts <a href=https://github.com/Hyperfoil/hyperfoil_test/blob/master/benchmarks/example.yaml.j2>simple benchmark</a> (the templating engine replaces the agents in benchmark script based on Ansible hosts) and waits for its completion. When it confirms number of requests executed it stops the controller.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hyperfoil-agent, hyperfoil-controller ]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>tasks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># This will only gather facts about all nodes</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hyperfoil-controller</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>hyperfoil.hyperfoil_setup</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>127.0.0.1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>connection</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>local</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>hyperfoil.hyperfoil_test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>test_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Note that due to the way Ansible lookups work this will work only if hyperfoil-controller == localhost</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>127.0.0.1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>connection</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>local</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>tasks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Find number of requests</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>set_fact</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>test_requests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;{{ lookup(&#39;csvfile&#39;, &#39;example file=/tmp/hyperfoil/workspace/run/&#39; + test_runid + &#39;/stats/total.csv col=2 delimiter=,&#39;)}}&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Print number of requests</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>debug</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>msg</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Executed {{ test_requests }} requests.&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>hyperfoil-controller</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>hyperfoil.hyperfoil_shutdown</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Finally, run the playbook:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ansible-playbook -i hosts example.yml
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-1aa0b1f37dce687249000b3550a88754>2 - Benchmark</h1><div class=lead>Detailed breakdown of each component involved in defining a benchmark</div><p>In Hyperfoil, defining a benchmark involves structuring scenarios, phases, variables and other components to simulate realistic user behavior and workload patterns. This section provides a detailed breakdown of each component involved in defining a benchmark.</p></div><div class=td-content><h1 id=pg-58d6d997673b74a5517024f9baf5d16e>2.1 - Agents</h1><div class=lead>Entities responsible for executing benchmark and collecting statistics</div><p>This section can be omitted in <a href=/docs/user-guide/installation/start_manual/>standalone mode</a>.</p><p>Agents section forms either a list or map with arbitrary agent names and either an inline or properties-style definition:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>agents</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>someAgent</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;inline definition&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>otherAgent</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>foo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>bar</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The definition is passed to an instance of <code>i.h.api.deployment.Deployer</code> which will interpret the definition. Deployer implementation is registred using the <code>java.util.ServiceLoader</code> and selected through the <code>io.hyperfoil.deployer</code> system property. The default implementation is <code>ssh</code>.</p><h2 id=common-properties>Common properties<a class=td-heading-self-link href=#common-properties aria-label="Heading self-link"></a></h2><table><thead><tr><th>Property</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>threads</td><td>from benchmark</td><td>Number of threads used by the agent (overrides <code>threads</code> in benchmark root).</td></tr><tr><td>extras</td><td></td><td>Custom options passed to the JVM (system properties, JVM options&mldr;)</td></tr></tbody></table><h2 id=ssh-deployer>SSH deployer<a class=td-heading-self-link href=#ssh-deployer aria-label="Heading self-link"></a></h2><p>The user account running Hyperfoil Controller must have a public-key authorization set up on agents&rsquo; hosts using key <code>$HOME/.ssh/id_rsa</code>. It also has to be able to copy files into the <code>dir</code> directory using SCP - all the required JARs will be copied there and you will find the logs there as well.</p><p><code>ssh</code> deployer accepts either the <code>[user@]host[:port]</code> inline syntax or these properties:</p><table><thead><tr><th>Property</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>user</td><td>Current username</td><td></td></tr><tr><td>host</td><td></td><td>This property is mandatory.</td></tr><tr><td>port</td><td>22</td><td></td></tr><tr><td>sshKey</td><td>id_rsa</td><td>Optionally define a different named key in the <code>$HOME/.ssh</code> directory</td></tr><tr><td>dir</td><td>Directory set by system property <code>io.hyperfoil.rootdir</code> or <code>/tmp/hyperfoil</code></td><td>Working directory for the agent. This directory can be shared by multiple agents running on the same physical machine.</td></tr><tr><td>cpu</td><td>(all cpus)</td><td>If set the CPUs where the agent can run is limited using <code>taskset -c &amp;lt;cpu&amp;gt;</code>. Example: <code>0-2,6</code></td></tr></tbody></table><p>See an example of ssh deployment configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>agents</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>agent1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testserver1:22</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>agent2</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testuser@testserver2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>agent3</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testserver3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>dir</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/some/other/path</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=kubernetesopenshift-deployer>Kubernetes/Openshift deployer<a class=td-heading-self-link href=#kubernetesopenshift-deployer aria-label="Heading self-link"></a></h2><p>To activate the kubernetes deployer you should set <code>-Dio.hyperfoil.deployer=k8s</code>; the <a href=/docs/user-guide/installation/k8s/>recommended installation</a> does that automatically.</p><p>The agents are configured the same way as with SSH deployment, only the properties differ. Full reference is provided below.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>agents</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>my-agent</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>node</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-worker-node</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><table><thead><tr><th>Property</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>node</td><td></td><td>Configures the labels for the <code>nodeSelector</code>. If the value does not contain equals sign (<code>=</code>) or comma (<code>,</code>) this sets the desired value of label <code>kubernetes.io/hostname</code>. You can also set multiple custom labels separated by commas, e.g. <code>foo=bar,kubernetes.io/os=linux</code>.</td></tr><tr><td>stop</td><td>true</td><td>By default the controller stops all agents immediatelly after the run terminates. In case of errors this is not too convenient as you might want to perform further analysis. To prevent automatic agent shutdown set this to false.</td></tr><tr><td>log</td><td></td><td>Name of config map (e.g. <code>my-config-map</code>) or config map and its entry (e.g. <code>my-config-map/log4j2.xml</code>) that contains the Log4j2 configuration file. Default entry from the config map is <code>log4j2.xml</code>. Hyperfoil will mount this configmap as a volume to this agent.</td></tr><tr><td>image</td><td>quay.io/hyperfoil/hyperfoil:<em>controller-version</em></td><td>Different version of Hyperfoil in the agents</td></tr><tr><td>imagePullPolicy</td><td>Always</td><td>Image pull policy for agents</td></tr><tr><td>fetchLogs</td><td>true</td><td>Automatically watch agents&rsquo; logs and store them in the run directory.</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-b1acdfa3d39eb15b26e75568d16f4ab3>2.2 - HTTP</h1><div class=lead>This section defines servers that agents contact during benchmarks, allowing configurations for multiple targets with specific connection settings</div><p>All servers that Hyperfoil should contact must be declared in this section. Before the benchmark starts Hyperfoil agents will open connections to the target servers; if this connection fails the benchmark is terminated immediatelly.</p><p>You can either declare single target server (the default one) within this section or more of them:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://example.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://example.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://example.com:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>50</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>HTTP configuration has these properties:</p><table><thead><tr><th>Property</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>protocol</td><td></td><td>Either <code>http</code> or <code>https</code></td></tr><tr><td>host</td><td></td><td>Hostname of the server. For convenience you can use the <code>http[s]://host[:port]</code> inline syntax as shown above</td></tr><tr><td>port</td><td><code>80</code> or <code>443</code></td><td>Default is based on the <code>protocol</code></td></tr><tr><td><a href=#shared-connections>sharedConnections</a></td><td>1</td><td>Number of connections to open. It is recommended to set this property to a non-default value.</td></tr><tr><td><a href=#connection-strategies>connectionStrategy</a></td><td>SHARED_POOL</td><td>Connection pooling model (see details below)</td></tr><tr><td>addresses</td><td></td><td>Supply list of IPs or IP:port targets that will be used for the connections instead of resolving the <code>host</code> in DNS and using <code>port</code> as set - <code>host</code> and <code>port</code> will be used only for <code>Host</code> headers and SNI. If this list contains more addresses the connections will be split evenly.</td></tr><tr><td>requestTimeout</td><td>30 seconds</td><td>Default request timeout, this can be overridden in each <code>httpRequest</code>.</td></tr><tr><td>allowHttp1x</td><td>true</td><td>Allow HTTP 1.1 for connections (e.g. during ALPN).</td></tr><tr><td>allowHttp2x</td><td>true</td><td>Allow HTTP 2.0 for connections (e.g. during ALPN). If both 1.1 and 2.0 are allowed and <code>https</code> is not used (which would trigger ALPN) Hyperfoil will use HTTP 1.1. If only 2.0 is allowed Hyperfoil will start with HTTP 1.1 and perform protocol upgrade to 2.0.</td></tr><tr><td>directHttp2</td><td>false</td><td>Start with H2C HTTP 2.0 without protocol upgrade. Makes sense only for plain text (<code>http</code>) connections. Currently not implemented.</td></tr><tr><td>maxHttp2Streams</td><td>100</td><td>Maximum number of requests concurrently enqueued on single HTTP 2.0 connection.</td></tr><tr><td>pipeliningLimit</td><td>1</td><td>Maximum number of requests pipelined on single HTTP 1.1 connection.</td></tr><tr><td>rawBytesHandlers</td><td>true</td><td>Enable or disable using handlers that process HTTP response raw bytes.</td></tr><tr><td><a href=#keymanager-configuration>keyManager</a></td><td></td><td>TLS key manager for setting up client certificates.</td></tr><tr><td><a href=#trustmanager-configuration>trustManager</a></td><td></td><td>TLS trust manager for setting up server certificates.</td></tr></tbody></table><h2 id=shared-connections>Shared connections<a class=td-heading-self-link href=#shared-connections aria-label="Heading self-link"></a></h2><p>This number is split between all agents and executor threads evenly; if there are too many agents/executors each will get at least 1 connection.</p><p>When a scalar value is used for this property the connection pool has fixed size; Hyperfoil opens all connections when the benchmark starts and should a connection be closed throughout the benchmark, another connection is reopened instead. You can change this behaviour by composing the property of these sub-properties:</p><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>core</td><td>Number of connections that will be opened when the benchmark starts. Number of connections in the pool should never drop below this value (another connection will be opened instead).</td></tr><tr><td>max</td><td>Maximum number of connections in the pool.</td></tr><tr><td>buffer</td><td>Hyperfoil will try to keep at least <code>active + buffer</code> connections in the pool where <code>active</code> is the number of currently used connection (those with at least 1 in-flight request)</td></tr><tr><td>keepAliveTime</td><td>When a connection is not used for more than this value (in milliseconds) it will be closed. Non-positive value means that the connection is never closed because of being idle.</td></tr></tbody></table><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://example.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>core</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>buffer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>keepAliveTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>30000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=connection-strategies>Connection strategies<a class=td-heading-self-link href=#connection-strategies aria-label="Heading self-link"></a></h2><p>This property describes the connection pooling model, you can choose from the options below:</p><table><thead><tr><th>Strategy</th><th>Description</th></tr></thead><tbody><tr><td>SHARED_POOL</td><td>Connections are created in a pool and then borrowed by the session. When the request is complete the connection is returned to the shared pool.</td></tr><tr><td>SESSION_POOLS</td><td>Connections are created in a shared pool. When the request is completed it is not returned to the shared pool but to a session-local pool. Subsequent requests by this session first try to acquire the connection from this local pool. When the session completes all connections from the session-local pool are returned to the shared pool.</td></tr><tr><td>OPEN_ON_REQUEST</td><td>Connections are created before request or borrowed from a session-local pool. When the request is completed the connection is returned to this pool. When the session completes all connections from the session-local pool are closed.</td></tr><tr><td>ALWAYS_NEW</td><td>Always create the connection before the request and close it when it is complete. No pooling of connections.</td></tr></tbody></table><h2 id=keymanager-configuration>KeyManager configuration<a class=td-heading-self-link href=#keymanager-configuration aria-label="Heading self-link"></a></h2><p>All files are loaded when the benchmark is constructed, e.g. on the machine running CLI. You don&rsquo;t need to upload any files to controller or agent machines.</p><table><thead><tr><th>Property</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>storeType</td><td>JKS</td><td>Implementation of the store.</td></tr><tr><td>storeFile</td><td></td><td>Path to a file with the store.</td></tr><tr><td>password</td><td></td><td>Password for accessing the store file.</td></tr><tr><td>alias</td><td></td><td>Keystore alias.</td></tr><tr><td>certFile</td><td></td><td>Path to a file with the client certificate.</td></tr><tr><td>keyFile</td><td></td><td>Path to a file with client&rsquo;s private key.</td></tr></tbody></table><h2 id=trustmanager-configuration>TrustManager configuration<a class=td-heading-self-link href=#trustmanager-configuration aria-label="Heading self-link"></a></h2><p>All files are loaded when the benchmark is constructed, e.g. on the machine running CLI. You don&rsquo;t need to upload any files to controller or agent machines.</p><table><thead><tr><th>Property</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>storeType</td><td>JKS</td><td>Implementation of the store.</td></tr><tr><td>storeFile</td><td></td><td>Path to a file with the store.</td></tr><tr><td>password</td><td></td><td>Password for accessing the store file.</td></tr><tr><td>certFile</td><td></td><td>Path to a file with the server certificate.</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-64114ea0efc225d733997a7c881c7cfd>2.3 - Phases</h1><div class=lead>Defines a unit of workload simulation within a benchmark, representing a specific load pattern or behavior</div><p>You might want to simulate several types of workloads at once: e.g. in an eshop users would come browsing or buying products, and operators would restock the virtual warehouse. Also, driving constant load may not be the best way to run the benchmark: often you want to slowly ramp the load up to let the system adjust (scale up, perform JIT, fill pools) and push the full load only after that. When trying to find system limits, you do the same repetitevely - ramp up the load, measure latencies and if the system meets SLAs (latencies below limits) continue ramping up the load until it breaks.</p><p>In Hyperfoil, this all is expressed through <em>phases</em>. Phases can run independently of each other;
these simulate certain load execute by a group of users. Within one phase all users execute the same <code>scenario</code>
(e.g. logging into the system, buying some goods and then logging off).</p><p>A phase can be in one of these states:</p><ul><li><em>not running (scheduled)</em>: As the name clearly says, the phase is not yet getting executed.</li><li><em>running</em>: The agent started running the phase, i.e., performing the configured load.</li><li><em>finished</em>: Users won&rsquo;t start new scenarios but we&rsquo;ll let already-started users complete the scenario.</li><li><em>terminated</em>: All users are done, all stats are collected and no further requests will be made.</li><li><em>cancelled</em>: Same as terminated but this phase hasn&rsquo;t been run at all.</li></ul><p>There are different types of phases based on the mode of starting new users:</p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>constantRate</td><td>The benchmark will start certain number of users according to a schedule regardless of previously started users completing the scenario. This is the open-model.</td></tr><tr><td>increasingRate</td><td>Similar to <code>constantRate</code> but ramps up the number of started users throughout the execution of the phase.</td></tr><tr><td>decreasingRate</td><td>The same as <code>increasingRate</code> but requires <code>initialUsersPerSec</code> > <code>targetUsersPerSec</code>.</td></tr><tr><td>atOnce</td><td>All users are be started when the phase starts running and once the scenario is completed the users won&rsquo;t retry the scenario.</td></tr><tr><td>always</td><td>There is fixed number of users and once the scenario is completed the users will start executing the scenario from beginning. This is called a closed-model and is similar to the way many benchmarks with fixed number of threads work.</td></tr><tr><td>noop</td><td>This phase cannot have any scenario (or forks). It might be useful to add periods of inactivity into the benchmark.</td></tr></tbody></table><p>See the example of phases configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>phases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Over one minute ramp the number of users started each second from 1 to 100</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>rampUp</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>increasingRate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>initialUsersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>targetUsersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># We expect at most 200 users being active at one moment - see below</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>maxSessions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>200</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>1m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># After rampUp is finished, run for 5 minutes and start 100 new users each second</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>steadyState</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>constantRate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>maxSessions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>200</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>startAfter</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rampUp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>5m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># If some users get stuck, forcefully terminate them after 6 minutes from the phase start</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>maxDuration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>6m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># 2 minutes after the benchmark has started spawn 5 users constantly doing something for 2 minutes</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>outOfBand</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>always</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>startTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>2m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>2m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>final</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>atOnce</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># Do something at the end: make sure that both rampUp and steadyState are terminated</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>startAfterStrict</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>rampUp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>steadyState</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>These properties are common for all types of phases:</p><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>startTime</td><td>Time relative to benchmark start when this phase should be scheduled. In other words, it&rsquo;s the earliest moment when it could be scheduled, other conditions (below) may delay that even further.</td></tr><tr><td>startAfter</td><td>Phases that must be <em>finished</em> before this phase can start. You can use either single phase name, list of phases or a <a href=#iterations>reference to certain iteration</a>.</td></tr><tr><td>startAfterStrict</td><td>Phases that must be <em>terminated</em> before this phase can start. Use the same syntax as for <code>startAfter</code>.</td></tr><tr><td>duration</td><td>Intended duration for the phase (must be defined but for the <code>atOnce</code> type). After this time elapses no new sessions will be started; there might be some running sessions still executing operations, though.</td></tr><tr><td>maxDuration</td><td>After this time elapses all sessions are forcefully terminated.</td></tr><tr><td>isWarmup</td><td>This marker property is propagated to results JSON and allows the reporter to hide some phases by default.</td></tr><tr><td>maxUnfinishedSessions</td><td>Maximum number of session that are allowed to be open when the phase <em>finishes</em>. When there are more open sessions all the other sessions are cancelled and the benchmark is terminated. Unlimited by default.</td></tr><tr><td>maxIterations</td><td>Maximum number of <a href=#iterations>iterations</a> this phase will be scaled to. More about that below.</td></tr><tr><td><a href=/docs/user-guide/benchmark/scenario/>scenario</a></td><td>The scenario this phase should execute.</td></tr><tr><td><a href=#forks>forks</a></td><td>See forks section below.</td></tr></tbody></table><p>Below are properties specific for different phase types:</p><ul><li><code>atOnce</code>:<ul><li><code>users</code>: Number of users started at the start of the phase.</li></ul></li><li><code>always</code>:<ul><li><code>users</code>: Number of users started at the start of the phase. When a user finishes it is immediatelly restarted (any pause must be part of the scenario).</li></ul></li><li><code>constantRate</code>:<ul><li><code>usersPerSec</code>: Number of users started each second.</li><li><code>variance</code>: Randomize delays between starting users following the <a href=https://en.wikipedia.org/wiki/Exponential_distribution>exponential distribution</a>. That way the starting users behave as the <a href=https://en.wikipedia.org/wiki/Poisson_point_process>Poisson point process</a>. If this is set to <code>false</code> users will be started with uniform delays. Default is <code>true</code>.</li><li><code>maxSessions</code>: Number of preallocated sessions. This number is split between all agents/executors evenly.</li></ul></li><li><code>increasingRate</code> / <code>decreasingRate</code>:<ul><li><code>initialUsersPerSec</code>: Rate of started users at the beginning of the phase.</li><li><code>targetUsersPerSec</code>: Rate of started users at the end of the phase.</li><li><code>variance</code>: Same as in `constantRate</li><li><code>maxSessions</code>: Same as in <code>constantRate</code>.</li></ul></li></ul><p>Hyperfoil initializes all phases before the benchmark starts, pre-allocating memory for sessions.
In the open-model phases it&rsquo;s not possible to know how many users will be active at the same moment
(if the server experiences a 3-second hiccup and we have 100 new users per second this should be at least 300
as all the users will be blocked). However we need to provide the estimate for memory pre-allocation.
If the estimate gets exceeded the benchmark won&rsquo;t fail nor block new users from starting, but new sessions
will be allocated which might negatively impact results accuracy.</p><p>Properties <code>users</code>, <code>usersPerSec</code>, <code>initialUsersPerSec</code> and <code>targetUsersPerSec</code> can be either a scalar number or <a href=#iterations>scale with iterations</a> using the <code>base</code> and <code>increment</code> components. You&rsquo;ll see an example below.</p><h2 id=forks>Forks<a class=td-heading-self-link href=#forks aria-label="Heading self-link"></a></h2><p>As mentioned earlier, users in each phase execute the same scenario. Often it&rsquo;s convenient
to define the ramp-up and steady-state phases just once: the builders allow to declare such &lsquo;sub-phases&rsquo; called forks.
For all purposes but the benchmark configuration these become regular phases of the same type, duration and dependencies (<code>startAfter</code>, <code>startAfterStrict</code>) as the &lsquo;parent&rsquo; phase but slice the users according to their <code>weight</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>phases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>steadyState</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>constantRate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>5m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>forks</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>sellShares</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># This phase will start 10 users per second</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>buyShares</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># This phase will start 20 users per second</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>These phases will be later identified as <code>steadyState/sellShares</code> and <code>steadyState/buyShares</code>. Other phases can still
reference <code>steadyState</code> (without suffix) as the dependency: there will be a no-op phase <code>steadyState</code> that starts (becomes <em>running</em>) as soon as both the forks <em>finish</em>, <em>finish</em> immediately and terminate once both the forks <em>terminate</em>.</p><h2 id=iterations>Iterations<a class=td-heading-self-link href=#iterations aria-label="Heading self-link"></a></h2><p>In some types of tests it&rsquo;s useful to repeat given phase with increasing load - we call this concept <em>iterations</em>. In the example below you can see that <code>*usersPerSec</code> are not scalar values; in first iteration the actual value is set to the <code>base</code> value but in each subsequent iteration the value is increased by <code>increment</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>phases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>rampUp</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>increasingRate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># Create phases rampUp/000, rampUp/001 and rampUp/002</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>maxIterations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># rampUp/000 will go from 1 to 100 users, rampUp will go from 101 to 200 users...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>initialUsersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>base</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>increment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>targetUsersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>base</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>increment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># rampUp/001 will start after steadyState/000 finishes</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>startAfter</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>phase</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>steadyState</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>iteration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>previous</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>1m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>steadyState</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>constantRate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>maxIterations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>base</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>increment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># steadyState/000 will start after rampUp/000 finishes</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>startAfter</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>phase</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rampUp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>iteration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>same</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>5m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Similar to forks, there will be a no-op phase <code>rampUp</code> that will start after all
<code>rampUp/xxx</code> phases finish and terminate after these terminate. Also there&rsquo;s an implicit dependency
between consecutive iterations: subsequent iteration won&rsquo;t start until previous iteration <em>terminates</em>.</p><p>The <code>startAfter</code> property in this example uses a relative reference to iteration in another phase. Each reference has these properties:</p><p>| Property | Description |
| &mdash;&mdash;&mdash; | |
| phase | Name of the referenced phase. |
| iteration | Relative number of the iteration; either <code>none</code> (default) which references the top-level phase, <code>same</code> meaning the iteration with same number, or <code>previous</code> with number one lower. |
| fork | Reference to particular fork in the phase/iteration. |</p><p>Iterations can be combined with forks as well - the result name would be e.g. <code>steadyState/000/sellShares</code>.</p><p>Note that the <code>maxSessions</code> parameter is not scaling in iterations: all iterations execute the same
scenario, the execution does not overlap and therefore it is possible to share the pool of sessions.
Therefore you should provide an estimate for the iteration spawning the highest load.</p><h2 id=staircase>Staircase<a class=td-heading-self-link href=#staircase aria-label="Heading self-link"></a></h2><p>Hyperfoil tries to make opinionated decisions, simplifying common types of benchmark setups. That&rsquo;s why it offers a simplified syntax for the scenario where you:</p><ul><li>ramp the load to a certain level</li><li>execute steady state for a while</li><li>ramp it up further</li><li>execute another steady state</li><li>repeat previous two steps over and over</li></ul><p>This is called a <em>staircase</em> as the load increases in a shape of tilted stairs. Phases such benchmark should consist of are automatically created and linked together, using the same scenario/forks.</p><p><code>staircase</code> as a top-level element in the benchmark is mutually exclusive to <code>scenario</code> and <code>phases</code> elements.</p><p>Here is a minimalistic example of such configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>simple benchmark</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>staircase</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>initialRampUpDuration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>steadyStateDuration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>rampUpDuration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>5s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>initialUsersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>incrementUsersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>maxIterations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/foo</span></span></span></code></pre></div><p>This element uses these properties:</p><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>initialRampUpDuration</td><td>Duration of the very first phase. Default is no initial ramp-up.</td></tr><tr><td>initialUsersPerSec</td><td>Rate of users starting at the end of the initial ramp-up.</td></tr><tr><td>steadyStateDuration</td><td>Duration of each steady-state phase.</td></tr><tr><td>rampUpDuration</td><td>Duration of each but first ramp-up. Default are no ramp-ups.</td></tr><tr><td>incrementUsersPerSec</td><td>Increase in the rate of started users in each iteration.</td></tr><tr><td>maxIterations</td><td>Maximum number of steady-state iterations.</td></tr><tr><td><a href=/docs/user-guide/benchmark/scenario/>scenario</a></td><td>The scenario to be executed.</td></tr><tr><td><a href=#forks>forks</a></td><td>The forks with different scenarios.</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-02d9ad0faa5977a6fc32c799a9f1fe2b>2.4 - Scenario</h1><div class=lead>Defines the behavior and sequence of actions that virtual users (VU) perform during a benchmark execution</div><h1 id=scenario>Scenario<a class=td-heading-self-link href=#scenario aria-label="Heading self-link"></a></h1><p>Scenario is a set of <em>sequences</em>. The sequence is a block of sequentially executed <em>steps</em>. Contrary to steps in a sequence the sequences within a scenario do not need to be executed sequentially.</p><p>The scenario defines one or more <code>initialSequences</code> that are enabled from the beginning and other <code>sequences</code> that
must be enabled by any of the previously executed sequences. To be more precise it is not the <em>sequence</em>
that is enabled but a <em>sequence instance</em> as we can run a sequence multiple times in parallel (on different data).
The <code>initialSequences</code> enable one instance of each of the referenced sequence.</p><p>The session keeps a currently executed step for each of the enabled sequence instances. The step can be blocked
(e.g. waiting for a response to come). The session is looping through current steps in each of the enabled
sequence instances and if the step is not blocked, it is executed. There&rsquo;s no guaranteed order in which non-blocked
steps from multiple enabled sequence instances will be executed.</p><p>Here is an example of scenario:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>initialSequences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>login</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>POST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/login</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># Enable instance of sequence &#39;wait5seconds&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>next</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>wait5seconds</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sequences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>wait5seconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>thinkTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>5s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>next</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>logout</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>logout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>POST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/logout</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>While this generic approach is useful for complex scenarios with branching logic, simple sequential scenarios can use <code>orderedSequences</code> short-cut enabling sequences in given order:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>orderedSequences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>login</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>POST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/login</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>wait5seconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>thinkTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>5s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>logout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>POST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/logout</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>This syntax makes the first sequence (<code>login</code> in this case) an initial sequence, adds the subsequent sequences and as the last step of each but the last sequence appends a <code>next</code> step scheduling a new instance of the following sequence.</p><p>To make configuration even more concise you can omit the <code>orderedSequences</code> level and start defining the list of sequences under <code>scenario</code> right away:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>login</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>POST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/login</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>wait5seconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>thinkTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>5s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>logout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>POST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/logout</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>An exhaustive list of steps can be found in the <a href=/docs/reference/steps/>steps reference</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-4857c7f234ff4c339e1e27e0d7c72157>2.5 - Variables</h1><div class=lead>Data placeholders within sessions that hold values throughout the execution of a benchmark scenario</div><p>All but the simplest scenarios will use session variables. Hyperfoil sports steps that generate values into these variables (<code>randomInt</code>, <code>randomItem</code>, &mldr;), processors that write data from other sources to variables (<code>store</code>, <code>array</code>) and many places that read variables and use the values to perform some operations (<code>httpRequest.path</code> ) or alter control flow.</p><p>Hyperfoil uses different types of variables (slots in the session) for integer variables and generic objects (commonly strings). When a numeric value is received as a string (e.g. when parsing response headers) and you want to use it in a step that expects exclusively integral values you have to convert it explicitly, e.g. using the <code>stringToInt</code> action. Steps that read values to form a string can usually consume both types of variables, without any need for conversion.</p><p>Besides user-defined variables there are some read-only pseudo-variables that can be used in the scenario as if these were regular variables:</p><table><thead><tr><th>Variable</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>hyperfoil.agent.id</td><td>integer</td><td>Zero-based index of the <a href=/docs/user-guide/benchmark/agents/>agent node</a></td></tr><tr><td>hyperfoil.agents</td><td>integer</td><td>Number of <a href=/docs/user-guide/benchmark/agents/>agent nodes</a> or 1 when running in in-VM mode (standalone or CLI)</td></tr><tr><td>hyperfoil.agent.thread.id</td><td>integer</td><td>Zero-based index of current executor thread within this agent.</td></tr><tr><td>hyperfoil.agent.thread s</td><td>integer</td><td>Number of executor threads running in this agent.</td></tr><tr><td>hyperfoil.global.thread.id</td><td>integer</td><td>Zero-based index of current executor thread across all agents (unique).</td></tr><tr><td>hyperfoil.global.threads</td><td>integer</td><td>Total number of executor threads on all agents.</td></tr><tr><td>hyperfoil.phase.name</td><td>object</td><td>Full name of the currently executed phase (possibly including fork and iteration number).</td></tr><tr><td>hyperfoil.phase.id</td><td>integer</td><td>Index of the currently executed phase.</td></tr><tr><td>hyperfoil.phase.iteration</td><td>integer</td><td>Iteration number of the currently executed phase.</td></tr><tr><td>hyperfoil.run.id</td><td>object</td><td>Identifier of the current run, e.g. <code>0123</code>.</td></tr><tr><td>hyperfoil.session.id</td><td>integer</td><td>Unique index of this virtual user (session). Note that in benchmarks with multiple phases the indices might not be zero-based.</td></tr></tbody></table><h2 id=string-interpolation>String interpolation<a class=td-heading-self-link href=#string-interpolation aria-label="Heading self-link"></a></h2><p>Components that accept string values usually allow you to use a <em>pattern</em> - parts of the string can be replaced in runtime with the value from a session variable. A simple example of pattern would be <code>The quick brown ${wild-animal} jumps over the lazy ${domestic-animal}</code> - variables <code>wild-animal</code> and <code>domestic-animal</code> would get replaced with their respective values.</p><p>When you really want to use <code>${wild-animal}</code> in a value for such component you should escape it with one more dollar sign: <code>This $${variable} won't be replaced</code> will be rendered into <code>This ${variable} won't be replaced</code>.</p><p>There are a few transformations that you can perform with a variable value while interpolating the pattern:</p><ul><li><code>${urlencode:my-variable}</code> will replace characters in the <code>my-variable</code> using <a href=https://docs.oracle.com/javase/7/docs/api/java/net/URLEncoder.html#encode(java.lang.String,%20java.lang.String)>URLEncoder.encode</a> (using UTF-8 encoding).</li><li><code>${{ '{%05d' }}:my-number}</code> and other formatter strings ending with <code>d</code>, <code>o</code>, <code>x</code> or <code>X</code> will convert an integer variable using <a href=https://docs.oracle.com/javase/7/docs/api/java/util/Formatter.html>Formatter</a>.</li><li><code>${replace/&lt;regexp>/&lt;replacement>/&lt;flags>:my-variable}</code> perform Java regexp replacement on <code>my-variable</code> contents. Note that you can use any character after <code>replace</code>, not just <code>/</code> - this becomes the separator between regexp, replacement and flags. The only flags currently supported is <code>g</code> - replacing all occurences of that string (by default only first occurence is replaced).</li></ul><h2 id=sequence-scoped-access>Sequence-scoped access<a class=td-heading-self-link href=#sequence-scoped-access aria-label="Heading self-link"></a></h2><p>When an array or collection is stored in a session variable you can access the individual elements by appending <code>[.]</code> to the variable name, e.g. <code>my-variable[.]</code>. You can see that we don&rsquo;t use the actual index into the array: instead we use current sequence instance index. You can read more about running multiple sequences concurrently in the <a href=/docs/architecture/#scenario-execution>Architecture/Scenario Execution</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ed2898c43a28d1cdf654b47cf571de58>2.6 - Templates</h1><div class=lead>Templates in Hyperfoil allow for efficient benchmark parametrization, enabling users to customize benchmarks based on specific execution environments or intended loads</div><p>It is often useful to keep a single benchmark in version control but change parts of it depending on the infrastructure where it is executed or intended load. Since <a href=/blog/releases/release_notes#018-2021-12-16>version 0.18</a> Hyperfoil supports parametrization of the benchmark through templates.</p><p>Inspired by other (more complex) YAML templating systems we decided to use YAML tags to pre-process the YAML. Templating happens even before applying the YAML nodes onto <code>BenchmarkBuilder</code>, therefore it is not possible to do that programmatically or with the serialized form.</p><p>If you are working with CLI or WebCLI there is little difference to regular benchmarks: you <code>upload</code> and <code>edit</code> the benchmark as usual. However it is not possible to auto-detect files before the benchmark is constructed from the template (the reference to a file could be a template, too!), therefore you need to pass all files using option <code>-f</code> to the <code>upload</code>/<code>edit</code> command.</p><p>When the benchmark template is uploaded, upon running it (<code>run mybenchmark</code>) you either pass the parameters using option <code>-P</code> or you are interactively asked to provide those params. The parameters are stored in CLI context and on subsequent invocations of <code>run</code> you don&rsquo;t need to set these. If you want to remove the parameters from the context use option <code>-r</code>/<code>--reset-params</code>. To see both default and current parameters you can use the <code>inspect</code> command.</p><h2 id=param>Param<a class=td-heading-self-link href=#param aria-label="Heading self-link"></a></h2><p>You should use <code>!param</code> to replace single scalar value:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://localhost:8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex;background-color:#dfdfdf><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>!<span style=color:#000>param NUM_USERS</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex;background-color:#dfdfdf><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>!<span style=color:#000>param DURATION 60s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># ...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In this simple constant-rate benchmark you can customize the number of users starting each second as well as the duration. There&rsquo;s no default for <code>NUM_USERS</code>; you will be asked to provide it when you run the benchmark. On the other hand <code>DURATION</code> has a default value of <code>60s</code> - anything after the space after parameter name counts as the default value.</p><p>Parameters don&rsquo;t have to be upper-case. The identifier is case-sensitive, though.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>run scalar-value-example -PNUM_USERS<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>5</span> -PDURATION<span style=color:#ce5c00;font-weight:700>=</span>60s
</span></span></code></pre></div><h2 id=concat>Concat<a class=td-heading-self-link href=#concat aria-label="Heading self-link"></a></h2><p>Sometimes you need to replace only part of a string: <code>!concat</code> will let you do that:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex;background-color:#dfdfdf><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>!<span style=color:#000>concat [ &#34;http://&#34;, !param SERVER localhost, &#34;:8080&#34; ]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>60s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># ...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In this example we will customize the host with the concatenation of <code>http://</code>, parameter <code>SERVER</code> with default <code>localhost</code> and <code>:8080</code>. This example uses inline-form of list, though you can use the regular list (one item per line), too.</p><h2 id=foreach>Foreach<a class=td-heading-self-link href=#foreach aria-label="Heading self-link"></a></h2><p>Chances are you need to generate a list based on a param: you can do this using the <code>!foreach</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>!<span style=color:#000>foreach</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex;background-color:#dfdfdf><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>items</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://example.com,http://hyperfoil.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex;background-color:#dfdfdf><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>separator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;,&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># comma is the default separator</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex;background-color:#dfdfdf><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>param</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ITEM  </span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># ITEM is the default parameter name</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex;background-color:#dfdfdf><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>do</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex;background-color:#dfdfdf><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>!<span style=color:#000>param ITEM</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>60s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># ...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>This splits the <code>items</code> using the separator regexp and produces a list of values or mappings while the param <code>ITEM</code> is set to one of the values from items list. The example above would result in:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://example.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://hyperfoil.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>60s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># ...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>You can also set <code>items</code> to a YAML list; in that case the <code>separator</code> is not used:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>myList</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>!<span style=color:#000>foreach</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>items</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;A&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span>!<span style=color:#000>param B, &#34;C&#34;]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>param</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>FOO</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>do</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>!<span style=color:#000>param FOO</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The last example with <code>-PB=bar</code> would result in:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>myList</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>A</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>bar</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>C</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Renaming the param used for iteration can be useful in nested loops: without renaming the inner foreach would shadow the outer one.</p><h2 id=anchors-and-aliases>Anchors and aliases<a class=td-heading-self-link href=#anchors-and-aliases aria-label="Heading self-link"></a></h2><p>YAML has a built-in concept for removing repetitive sections: anchors and aliases. With the templating system you can use that universally throughout the file (in versions before 0.18 the support was limited to forks, scenarios and sequences):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>foo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>&amp;hello-world</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>hello</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>world</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>anotherFoo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sayHi</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>*hello-world</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>myList</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#8f5902;font-style:italic>*hello-world</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>bar</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>is interpretted as</p><pre tabindex=0><code>foo:
  hello: world
anotherFoo:
  sayHi:
    hello: world
  myList:
  - hello: world
  - bar
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-eac813dee30aae69c7dc037191fce294>2.7 - Hooks</h1><div class=lead>Mechanisms that allow users to run specific scripts or commands automatically before and after executing a benchmark run</div><p>It might be useful to run certain scripts before and after the run, e.g. starting some infrastructure, preloading database, gathering CPU stats during the test and so on. That&rsquo;s why Hyperfoil introduces pre- and post-hooks to the run.</p><p>Some scripts are not specific to the test being run - these should be deployed on controller as files in <code>*root*/hooks/pre/</code> and <code>*root*/hooks/post</code> directories where <em>root</em> is controller&rsquo;s root directory, <code>/tmp/hyperfoil/</code> by default. Each of these directories should contain executable scripts or binaries that will be run in alphabetic order. We strongly suggest using the format <code>00-my-script.sh</code> to set the order using first two digits.</p><p>Kubernetes/Openshift deployments use the same strategy; the only difference is that the <code>pre</code> and <code>post</code> directories are mapped as volumes from a ConfigMap resource.</p><p>Other scripts may be specific to the benchmark executed and therefore you can define them directly in the YAML files. You can either use inline command that will be executed using <code>sh -c your-command --your-options</code> or create a Java class implementing <code>io.hyperfoil.core.hooks.RunHook</code> and register it to be <a href=/docs/getting-started/quickstart8/>loaded as other Hyperfoil extensions</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-benchmark</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>pre</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>01-inline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>curl http://example.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>02-custom</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>my-hook</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>foo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>bar</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>post</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>99-some-final-hook</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The lists of hooks from controller directories and benchmark are merged; if there&rsquo;s a conflict between two hooks from these two sources the final execution order is not defined (but both get executed).</p><p>In case of inline command execution the <code>stderr</code> output will stay on stderr, <code>stdout</code> will be caputered by Hyperfoil and stored in <code>*rundir*/*XXXX*/hooks.json</code>. As the post-hooks are executed after <code>info.json</code> and <code>all.json</code> get written the output cannot be included inside those files. This order of execution was chosen because it&rsquo;s likely that you will upload these files to a database - yes, using a post-hook.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9324f9d2479e31fa80f07d85df3cc6df>2.8 - Ergonomics</h1><div class=lead>Configuration options that enhance usability and automation of benchmarking sessions</div><p>This section hosts only single property at this moment:</p><table><thead><tr><th>Property</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>repeatCookies</td><td>true</td><td>Automatically parse cookies from HTTP responses, store them in session and resend them with subsequent requests.</td></tr><tr><td>userAgentFromSession</td><td>true</td><td>Add user-agent header to each request, holding the agent name and session id.</td></tr><tr><td>autoRangeCheck</td><td>true</td><td>Mark 4xx and 5xx responses as invalid. You can also turn this off in each step.</td></tr><tr><td>stopOnInvalid</td><td>true</td><td>When the session receives an invalid response it does not execute any further steps, cancelling all requests and stopping immediately.</td></tr><tr><td>followRedirect</td><td>NEVER</td><td>Default value for <a href=/docs/reference/steps/step_httpRequest#handler>httpRequest.handler.followRedirect</a>.</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-7db80c30652628d25611531a8cdce078>3 - Examples</h1><div class=lead>Collection of benchmark examples</div><p>If you haven&rsquo;t checked the <a href=/docs/getting-started/quickstart1/>Getting started guide</a> we strongly recommend going there first.</p><p>Below you&rsquo;ll see commented examples of configuration; contrary to the Getting started guide these don&rsquo;t present scenarios but rather list the various configuration options by example.</p><h2 id=httprequest>httpRequest<a class=td-heading-self-link href=#httprequest aria-label="Heading self-link"></a></h2><p>You will most likely use step <code>httpRequest</code> in each of your scenarios, and there&rsquo;s many ways to send a request.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># This example should demonstrate various ways to configure one of the most important</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># steps - the httpRequest.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http-requests</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://example.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>ergonomics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Disable stopping the scenario on 4xx or 5xx response</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>autoRangeCheck</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>jsonBody</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>POST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/foo/bar</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># Hyperfoil doesn&#39;t know what&#39;s the content of the body string, if the server</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># requires correct content-type header you have to provide it yourselves</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>headers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>content-type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>application/json</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># Here we specify a multi-line string. For more info about multiline strings,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># compacting/chopping of newlines etc. please check out https://yaml-multiline.info/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>body</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>           &#34;foo&#34; : &#34;bar&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        }</span><span style=color:#f8f8f8;text-decoration:underline>        
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>formBody</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>set</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>myVar &lt;- foobar</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>POST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/myform</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># Here we don&#39;t need to add any headers as the form: knows that you&#39;re sending</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># a HTML form and it can add &#39;content-type: application/x-www-form-urlencoded&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># automatically.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>body</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># This will generate body &#39;foo=bar&amp;bar=foobar&amp;goo=foofoobarbar&#39;. Any non-ascii</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># or otherwise illegal characters are correctly URL-encoded.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>form</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>foo</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>bar</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>bar</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>fromVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>myVar</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>goo</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>pattern</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>foo${myVar}bar</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>bodyFromFile</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>POST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/foo/bar</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>body</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># This simply loads the file and sends it as the body without any conversion.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># It does not add any headers nor make it a multipart upload as the browser would do.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>fromFile</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>usernames.txt</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>customHeaders</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>set</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>token &lt;- dGhpcyBpcyBhIG5pY2UgYW5kIHNlY3VyZSB0b2tlbgo=</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>set</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>etag &lt;- &#34;ETag received in some previous request&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/secured/page</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># Note that HTTP headers are case-insensitive (use your preferred capitalization)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>headers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># Headers can be set inline</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>accept</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>text/html</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># Session variables are replaced using the pattern syntax</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>authorization</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Bearer ${token}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># Values from session variables can be also loaded using fromVar</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>if-match</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>fromVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>etag</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>nonDefaultMetric</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/cats</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># By default the metric name equals to name of the sequence (&#39;nonDefaultMetric&#39; here).</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># We can override that either with a constant value...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>metric</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>mammals</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>randomItem</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>toVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>animal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>list</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>cats</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>dogs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>locusts</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/foo/${animal}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># ... or a regexp switch on the actual authority+path (e.g. example.com:8080/foo/cats).</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># If the benchmark uses single (default) HTTP target the authority is omitted.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>metric</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>.*cats -&gt; mammals</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>.*dogs -&gt; mammals</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- -<span style=color:#000>&gt; insects</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>toughSLAs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/index.html</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>handler</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>status</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># Any request that is not responded with status code will be marked as invalid.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>range</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>200</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># When you need only one SLA you can use mapping without the list (just forget the dash).</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>sla</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># This first SLA is evaluated when the phase completes from all requests that happened</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># during the phase.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># Errors are connection failures, timeouts, 4xx and 5xx responses</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>errorRatio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0.1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># You can set custom criteria for what is considered valid/invalid as with the status</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># handler above. By default any response with status that is not within 200-399</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># is deemed invalid (as well as error).</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>invalidRatio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0.2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>blockedRatio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>meanResponseTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ms</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># 90% requests should be under 100 ms, only 1% can be over 1 second</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>limits</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>0.9</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ms</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>0.99</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># Following SLA is evaluated when all the statistics for the past second arrive,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># accumulating results from the window (last 10 seconds). Therefore it can detect shorter</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># peaks of degraded performance.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>window</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10s</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>meanResponseTime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>50</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ms</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Some scenarios need to access multiple HTTP endpoints; following example shows an example configuration for that:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># This example manifests running a benchmark against multiple domains</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>more-servers</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://example.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>https://hyperfoil.io</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># With HTTPS, most modern servers will negotiate HTTP 2.0 as the application protocol.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Since HTTP 2.0 uses multiple streams over single TCP (TLS in this case) connection</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># you can usually set lower number of connections.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># You may want to route requests through a proxy/load balancer or simply use a domain</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># that is not resolvable. Configuration below will actually send the requests to addresses</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># set below, but the requests will use in the &#39;host: foobar.com&#39; in the headers</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># and in SNI if this goes over TLS (HTTPS).</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http://foobar.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Hyperfoil will split the connections evenly to the defined addresses</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># (an entry is considered single address for this purpose even if DNS registers</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># multiple IP addresses for the hostname).</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>sharedConnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addresses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Both hostnames and IP addresses are allowed</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000>proxy.my-locally-defined-domain.test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#0000cf;font-weight:700>192.168.1.10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># You can set a custom port as well</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#0000cf;font-weight:700>192.168.1.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>usersPerSec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>scenario</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># Authority is the combination of hostname and port.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>authority</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hyperfoil.io:443</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/docs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>randomItem</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>toVar</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hostname</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>list</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>example.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>foobar.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>httpRequest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># The target must be configured in the &#39;http&#39; section above; the correctness</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># is usually validated when parsing/building the benchmark but sometimes it is</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># only possible at runtime, potentially resulting in errors during execution.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>authority</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${hostname}:80</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>GET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/foo</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-b2c7826362a5f4e84154bb1e2badfada>4 - Troubleshooting</h1><div class=lead>Common technical issues that you could hit during benchmark development</div><h2 id=it-doesnt-work-can-you-help-me>It doesn&rsquo;t work. Can you help me?<a class=td-heading-self-link href=#it-doesnt-work-can-you-help-me aria-label="Heading self-link"></a></h2><p>The first step to identifying any issue is getting a verbose log - setting logging level to TRACE. How exactly you do that depends on the way you deploy Hyperfoil:</p><ol><li><p>If you use CLI and the <code>start-local</code> command, just run it as <code>start-local -l TRACE</code> which sets the default logging level. You&rsquo;ll find the log in <code>/tmp/hyperfoil.local.log</code> by default.</p></li><li><p>If you run Hyperfoil manually in <a href=/docs/user-guide/installation/start_manual/>standalone mode</a> (non-clustered) the agent will run in the same JVM as the controller. You need to add <code>-Dlog4j.configurationFile=file:///path/to/log4j2-trace.xml</code> option when starting <code>standalone.sh</code>. If you start Hyperfoil through Ansible the same is set using <code>hyperfoil_log_config</code> variable.</p></li><li><p>If you run Hyperfoil in clustered mode, the failing code is probably in the agents. You need to pass the logging settings to agents using the deployer; with <a href=/docs/user-guide/benchmark/agents/#ssh-deployer>SSH deployer</a> you need to add <code>-Dlog4j.configurationFile=file:///path/to/log4j2-trace.xml</code> to the <code>extras</code> property, in <a href=/docs/user-guide/benchmark/agents/#kubernetesopenshift-deployer>Kubernetes/Openshift</a> there is the <code>log</code> option that lets you set the logging configuration through a config-map.</p></li></ol><p>An example of Log4j2 configuration file with TRACE logging on is here:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;Configuration&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;Appenders&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;Console</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;CONSOLE&#34;</span> <span style=color:#c4a000>target=</span><span style=color:#4e9a06>&#34;SYSTEM_OUT&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;PatternLayout</span> <span style=color:#c4a000>pattern=</span><span style=color:#4e9a06>&#34;%d{HH:mm:ss,SSS} %-5p [%c] (%t) %m%n&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;/Console&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/Appenders&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;Loggers&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;Root</span> <span style=color:#c4a000>level=</span><span style=color:#4e9a06>&#34;TRACE&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;AppenderRef</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;CONSOLE&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;/Root&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/Loggers&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/Configuration&gt;</span>
</span></span></code></pre></div><p>TRACE-level logging can be very verbose to a point where it will pose a bottleneck. It&rsquo;s recommended to isolate your problem at lower request rate if that&rsquo;s possible.</p><p>If you need to print variable values for debugging, check out <a href=/docs/reference/steps/step_log>log step</a>.</p><h2 id=my-phase-fails-with-sla-failure-progress-was-blocked-waiting-for-a-free-connection-hint-increase-httpsharedconnections>My phase fails with SLA failure &lsquo;Progress was blocked waiting for a free connection. Hint: increase http.sharedConnections.&rsquo;<a class=td-heading-self-link href=#my-phase-fails-with-sla-failure-progress-was-blocked-waiting-for-a-free-connection-hint-increase-httpsharedconnections aria-label="Heading self-link"></a></h2><p>By default Hyperfoil uses single connection to each HTTP(s) host; the default is set so low to force you thinking about connection limits early during test development. If you don&rsquo;t override this value as in:</p><pre tabindex=0><code>http:
  host: http://hyperfoil.io
  sharedConnections: 1000
</code></pre><p>you get the error above, as the default SLA does not allow a session (virtual user) to be blocked due to not being able to acquire a connection from the connection pool immediatelly. If you can&rsquo;t increase number of connections (or use HTTP2 that allows multiple requests to multiplex within single connection), you can set</p><pre tabindex=0><code>- httpRequest:
    sla:
    - blockedRatio: 1000 # any value big enough
</code></pre><p>on each request to drop the default SLA. The <code>blockedRatio</code> value is a threshold ratio between time spent waiting for a free connection and waiting for the response.</p><p>You could also wonder why the sessions are missing a connection when the scenario should guarantee there&rsquo;s always a free connection e.g. when using <code>always</code> phase type with same number of users and connections. However this may not hold when the connection is closed (either explicitly or after receiving a 5xx response) - while Hyperfoil starts replacing that connection immediatelly it takes a moment. If you expects connections to be closed add a few (10%) extra connections. Another reason could be poor balancing of connections and sessions to threads (should be gone in version 0.8).</p><h2 id=when-i-set-host-header-for-http-request-i-get-warnings>When I set &lsquo;Host&rsquo; header for HTTP request I get warnings<a class=td-heading-self-link href=#when-i-set-host-header-for-http-request-i-get-warnings aria-label="Heading self-link"></a></h2><p>Hyperfoil automatically inserts the &lsquo;Host&rsquo; header to each request and when you try to override that for certain request it emits a warning:</p><pre tabindex=0><code>Setting `host` header explicitly is not recommended. Use the HTTP host and adjust actual target using `addresses` property.
</code></pre><p>With this warning on we don&rsquo;t inject the header as it <em>might</em> be intended, e.g. when the target server does not parse headers in a case-sensitive way (as it should!) and you have to use certain case. However, if you want to run your requests to a different IP than the host resolves to (e.g. hit <code>127.0.0.1:8080</code> with <code>Host: example.com</code>) you should rather use</p><pre tabindex=0><code>http:
  host: http://hyperfoil.io
  addresses:
  - 127.0.0.1:8080
</code></pre><h2 id=when-i-use-a-session-variable-i-am-seeing-the-error-variable-foo-is-not-set>When I use a session variable I am seeing the error &ldquo;Variable foo is not set!&rdquo;<a class=td-heading-self-link href=#when-i-use-a-session-variable-i-am-seeing-the-error-variable-foo-is-not-set aria-label="Heading self-link"></a></h2><pre tabindex=0><code>Errors:
in-vm: Variable foo is not set!
</code></pre><p>On occasion a scenario step has been seen to execute out of sequence. To ensure the variable is set beforehand use <code>initialSequences</code> with the step that populates the variable.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub Discussions" aria-label="GitHub Discussions"><a target=_blank rel=noopener href=https://github.com/Hyperfoil/Hyperofil/discussions aria-label="GitHub Discussions"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Twitter aria-label=Twitter><a target=_blank rel=noopener href=https://x.com/Hyperfoil aria-label=Twitter><i class="fab fa-twitter"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/Hyperfoil/Hyperofil aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Zulip aria-label=Zulip><a target=_blank rel=noopener href=https://hyperfoil.zulipchat.com/ aria-label=Zulip><i class="fab fa-z"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub Issues" aria-label="GitHub Issues"><a target=_blank rel=noopener href=https://github.com/Hyperfoil/Hyperofil/issues aria-label="GitHub Issues"><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2017&ndash;2024
<span class=td-footer__authors>Hyperfoil | <a href=https://www.apache.org/licenses/LICENSE-2.0>Apache License 2.0</a> |</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/hyperfoil-website-demo/js/main.min.53f3e04e8d693751b0d08317a1dfec9508d2a99f2a3d232d929e075cd6f20865.js integrity="sha256-U/PgTo1pN1Gw0IMXod/slQjSqZ8qPSMtkp4HXNbyCGU=" crossorigin=anonymous></script>
<script defer src=/hyperfoil-website-demo/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script>
<script src=/hyperfoil-website-demo/js/tabpane-persist.js></script></body></html>